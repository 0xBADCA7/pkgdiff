<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux aponomarenko 3.2.0-29-generic #46-Ubuntu SMP Fri Jul 27 17:03:23 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 3.1.8 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.2 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 0.6.5 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: wrapper.c - wrapper.c</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;wrapper.c&nbsp;</th><th> </th><th>&nbsp;wrapper.c&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 34</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 34</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/*</td><td> </td><td class="right">/*</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Why a wrapper?</td><td> </td><td class="right"> * Why a wrapper?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Let's say you want to port libssh from libcrypto of openssl to libfoo</td><td> </td><td class="right"> * Let's say you want to port libssh from libcrypto of openssl to libfoo</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * you are going to spend hours to remove every references to SHA1_Update()</td><td> </td><td class="right"> * you are going to spend hours to remove every references to SHA1_Update()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * to libfoo_sha1_update after the work is finished, you're going to have</td><td> </td><td class="right"> * to libfoo_sha1_update after the work is finished, you're going to have</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * only this file to modify it's not needed to say that your modifications</td><td> </td><td class="right"> * only this file to modify it's not needed to say that your modifications</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * are welcome.</td><td> </td><td class="right"> * are welcome.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "config.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;stdlib.h&gt;</td><td> </td><td class="right">#include &lt;stdlib.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;stdio.h&gt;</td><td> </td><td class="right">#include &lt;stdio.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;string.h&gt;</td><td> </td><td class="right">#include &lt;string.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "libssh/priv.h"</td><td> </td><td class="right">#include "libssh/priv.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/session.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/crypto.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/wrapper.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef HAVE_LIBGCRYPT</td><td> </td><td class="right">#ifdef HAVE_LIBGCRYPT</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;gcrypt.h&gt;</td><td> </td><td class="right">#include &lt;gcrypt.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "libssh/crypto.h"</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int alloc_key(struct crypto_struct *cipher) {</td><td> </td><td class="right">static int alloc_key(struct crypto_struct *cipher) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    cipher-&gt;key = malloc(cipher-&gt;keylen);</td><td> </td><td class="right">    cipher-&gt;key = malloc(cipher-&gt;keylen);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (cipher-&gt;key == NULL) {</td><td> </td><td class="right">    if (cipher-&gt;key == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return 0;</td><td> </td><td class="right">    return 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">SHACTX sha1_init(void) {</td><td> </td><td class="right">SHACTX sha1_init(void) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 265</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 267</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (gcry_cipher_setiv(cipher-&gt;key[0], IV, 8)) {</td><td> </td><td class="right">    if (gcry_cipher_setiv(cipher-&gt;key[0], IV, 8)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(cipher-&gt;key);</td><td> </td><td class="right">      SAFE_FREE(cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (gcry_cipher_open(&amp;cipher-&gt;key[1], GCRY_CIPHER_DES,</td><td> </td><td class="right">    if (gcry_cipher_open(&amp;cipher-&gt;key[1], GCRY_CIPHER_DES,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          GCRY_CIPHER_MODE_CBC, 0)) {</td><td> </td><td class="right">          GCRY_CIPHER_MODE_CBC, 0)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(cipher-&gt;key);</td><td> </td><td class="right">      SAFE_FREE(cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (gcry_cipher_setkey(cipher-&gt;key[1], key + 8, 8)) {</td><td> </td><td class="rblock">    if (gcry_cipher_setkey(cipher-&gt;key[1], <span class="insert">(unsigned char *)</span>key + 8, 8)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(cipher-&gt;key);</td><td> </td><td class="right">      SAFE_FREE(cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (gcry_cipher_setiv(cipher-&gt;key[1], IV + 8, 8)) {</td><td> </td><td class="rblock">    if (gcry_cipher_setiv(cipher-&gt;key[1], <span class="insert">(unsigned char *)</span>IV + 8, 8)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(cipher-&gt;key);</td><td> </td><td class="right">      SAFE_FREE(cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (gcry_cipher_open(&amp;cipher-&gt;key[2], GCRY_CIPHER_DES,</td><td> </td><td class="right">    if (gcry_cipher_open(&amp;cipher-&gt;key[2], GCRY_CIPHER_DES,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          GCRY_CIPHER_MODE_CBC, 0)) {</td><td> </td><td class="right">          GCRY_CIPHER_MODE_CBC, 0)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(cipher-&gt;key);</td><td> </td><td class="right">      SAFE_FREE(cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (gcry_cipher_setkey(cipher-&gt;key[2], key + 16, 8)) {</td><td> </td><td class="rblock">    if (gcry_cipher_setkey(cipher-&gt;key[2], <span class="insert">(unsigned char *)</span>key + 16, 8)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(cipher-&gt;key);</td><td> </td><td class="right">      SAFE_FREE(cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (gcry_cipher_setiv(cipher-&gt;key[2], IV + 16, 8)) {</td><td> </td><td class="rblock">    if (gcry_cipher_setiv(cipher-&gt;key[2], <span class="insert">(unsigned char *)</span>IV + 16, 8)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(cipher-&gt;key);</td><td> </td><td class="right">      SAFE_FREE(cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return 0;</td><td> </td><td class="right">  return 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void des3_1_encrypt(struct crypto_struct *cipher, void *in,</td><td> </td><td class="right">static void des3_1_encrypt(struct crypto_struct *cipher, void *in,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    void *out, unsigned long len) {</td><td> </td><td class="right">    void *out, unsigned long len) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 408</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 410</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef HAVE_OPENSSL_BLOWFISH_H</td><td> </td><td class="right">#ifdef HAVE_OPENSSL_BLOWFISH_H</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define HAS_BLOWFISH</td><td> </td><td class="right">#define HAS_BLOWFISH</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;openssl/blowfish.h&gt;</td><td> </td><td class="right">#include &lt;openssl/blowfish.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef HAVE_OPENSSL_DES_H</td><td> </td><td class="right">#ifdef HAVE_OPENSSL_DES_H</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define HAS_DES</td><td> </td><td class="right">#define HAS_DES</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;openssl/des.h&gt;</td><td> </td><td class="right">#include &lt;openssl/des.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#if (OPENSSL_VERSION_NUMBER&lt;0x00907000<span class="delete">0</span>)</td><td> </td><td class="rblock">#if (OPENSSL_VERSION_NUMBER&lt;0x00907000<span class="insert">L</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define OLD_CRYPTO</td><td> </td><td class="right">#define OLD_CRYPTO</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "libssh/crypto.h"</td><td> </td><td class="right">#include "libssh/crypto.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int alloc_key(struct crypto_struct *cipher) {</td><td> </td><td class="right">static int alloc_key(struct crypto_struct *cipher) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    cipher-&gt;key = malloc(cipher-&gt;keylen);</td><td> </td><td class="right">    cipher-&gt;key = malloc(cipher-&gt;keylen);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (cipher-&gt;key == NULL) {</td><td> </td><td class="right">    if (cipher-&gt;key == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 580</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 582</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif /* HAS_AES */</td><td> </td><td class="right">#endif /* HAS_AES */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef HAS_DES</td><td> </td><td class="right">#ifdef HAS_DES</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int des3_set_key(struct crypto_struct *cipher, void *key) {</td><td> </td><td class="right">static int des3_set_key(struct crypto_struct *cipher, void *key) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (cipher-&gt;key == NULL) {</td><td> </td><td class="right">  if (cipher-&gt;key == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (alloc_key(cipher) &lt; 0) {</td><td> </td><td class="right">    if (alloc_key(cipher) &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    DES_set_odd_parity(key);</td><td> </td><td class="right">    DES_set_odd_parity(key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">DES_set_odd_parity(key</span> + <span class="delete">8);</span></td><td> </td><td class="rblock">    <span class="insert">DES_set_odd_parity((void*)((uint8_t*)key</span> + <span class="insert">8));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    DES_set_odd_parity(key</span> + <span class="delete">16);</span></td><td> </td><td class="rblock"><span class="insert">    DES_set_odd_parity((void*)((uint8_t*)key</span> + <span class="insert">16));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    DES_set_key_unchecked(key, cipher-&gt;key);</td><td> </td><td class="right">    DES_set_key_unchecked(key, cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">DES_set_key_unchecked(key</span> + <span class="delete">8, cipher-&gt;key</span> + <span class="delete">sizeof(DES_key_schedule));</span></td><td> </td><td class="rblock">    <span class="insert">DES_set_key_unchecked((void*)((uint8_t*)key</span> + <span class="insert">8), (void*)((uint8_t*)cip</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    DES_set_key_unchecked(key</span> + <span class="delete">16, cipher-&gt;key</span> + 2 * <span class="delete">sizeof(DES_key_schedu</span></td><td> </td><td class="rblock"><span class="insert">her-&gt;key</span> + <span class="insert">sizeof(DES_key_schedule)));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">le));</span></td><td> </td><td class="rblock"><span class="insert">    DES_set_key_unchecked((void*)((uint8_t*)key</span> + <span class="insert">16), (void*)((uint8_t*)ci</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">pher-&gt;key</span> + 2 * <span class="insert">sizeof(DES_key_schedule)));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return 0;</td><td> </td><td class="right">  return 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void des3_encrypt(struct crypto_struct *cipher, void *in,</td><td> </td><td class="right">static void des3_encrypt(struct crypto_struct *cipher, void *in,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    void *out, unsigned long len, void *IV) {</td><td> </td><td class="right">    void *out, unsigned long len, void *IV) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  DES_ede3_cbc_encrypt(in, out, len, cipher-&gt;key,</td><td> </td><td class="right">  DES_ede3_cbc_encrypt(in, out, len, cipher-&gt;key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">cipher-&gt;key</span> + <span class="delete">sizeof(DES_key_schedule),</span></td><td> </td><td class="rblock">      <span class="insert">(void*)((uint8_t*)cipher-&gt;key</span> + <span class="insert">sizeof(DES_key_schedule)),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      cipher-&gt;key</span> + 2 * <span class="delete">sizeof(DES_key_schedule),</span></td><td> </td><td class="rblock"><span class="insert">      (void*)((uint8_t*)cipher-&gt;key</span> + 2 * <span class="insert">sizeof(DES_key_schedule)),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      IV, 1);</td><td> </td><td class="right">      IV, 1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void des3_decrypt(struct crypto_struct *cipher, void *in,</td><td> </td><td class="right">static void des3_decrypt(struct crypto_struct *cipher, void *in,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    void *out, unsigned long len, void *IV) {</td><td> </td><td class="right">    void *out, unsigned long len, void *IV) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  DES_ede3_cbc_encrypt(in, out, len, cipher-&gt;key,</td><td> </td><td class="right">  DES_ede3_cbc_encrypt(in, out, len, cipher-&gt;key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">cipher-&gt;key</span> + <span class="delete">sizeof(DES_key_schedule),</span></td><td> </td><td class="rblock">      <span class="insert">(void*)((uint8_t*)cipher-&gt;key</span> + <span class="insert">sizeof(DES_key_schedule)),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      cipher-&gt;key</span> + 2 * <span class="delete">sizeof(DES_key_schedule),</span></td><td> </td><td class="rblock"><span class="insert">      (void*)((uint8_t*)cipher-&gt;key</span> + 2 * <span class="insert">sizeof(DES_key_schedule)),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      IV, 0);</td><td> </td><td class="right">      IV, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void des3_1_encrypt(struct crypto_struct *cipher, void *in,</td><td> </td><td class="right">static void des3_1_encrypt(struct crypto_struct *cipher, void *in,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    void *out, unsigned long len, void *IV) {</td><td> </td><td class="right">    void *out, unsigned long len, void *IV) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef DEBUG_CRYPTO</td><td> </td><td class="right">#ifdef DEBUG_CRYPTO</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  ssh_print_hexa("Encrypt IV before", IV, 24);</td><td> </td><td class="right">  ssh_print_hexa("Encrypt IV before", IV, 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  DES_ncbc_encrypt(in, out, len, cipher-&gt;key, IV, 1);</td><td> </td><td class="right">  DES_ncbc_encrypt(in, out, len, cipher-&gt;key, IV, 1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  DES_ncbc_encrypt(out, in, len, <span class="delete">cipher-&gt;key</span> + <span class="delete">sizeof(DES_key_schedule),</span></td><td> </td><td class="rblock">  DES_ncbc_encrypt(out, in, len, <span class="insert">(void*)((uint8_t*)cipher-&gt;key</span> + <span class="insert">sizeof(DES</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      IV</span> + <span class="delete">8,</span> 0);</td><td> </td><td class="rblock"><span class="insert">_key_schedule)),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  DES_ncbc_encrypt(in, out, len, <span class="delete">cipher-&gt;key</span> + 2 * <span class="delete">sizeof(DES_key_schedule)</span></td><td> </td><td class="rblock"><span class="insert">      (void*)((uint8_t*)IV</span> + <span class="insert">8),</span> 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">,</span></td><td> </td><td class="rblock">  DES_ncbc_encrypt(in, out, len, <span class="insert">(void*)((uint8_t*)cipher-&gt;key</span> + 2 * <span class="insert">sizeof</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      IV</span> + <span class="delete">16,</span> 1);</td><td> </td><td class="rblock"><span class="insert">(DES_key_schedule)),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      (void*)((uint8_t*)IV</span> + <span class="insert">16),</span> 1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef DEBUG_CRYPTO</td><td> </td><td class="right">#ifdef DEBUG_CRYPTO</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  ssh_print_hexa("Encrypt IV after", IV, 24);</td><td> </td><td class="right">  ssh_print_hexa("Encrypt IV after", IV, 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void des3_1_decrypt(struct crypto_struct *cipher, void *in,</td><td> </td><td class="right">static void des3_1_decrypt(struct crypto_struct *cipher, void *in,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    void *out, unsigned long len, void *IV) {</td><td> </td><td class="right">    void *out, unsigned long len, void *IV) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef DEBUG_CRYPTO</td><td> </td><td class="right">#ifdef DEBUG_CRYPTO</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  ssh_print_hexa("Decrypt IV before", IV, 24);</td><td> </td><td class="right">  ssh_print_hexa("Decrypt IV before", IV, 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  DES_ncbc_encrypt(in, out, len, <span class="delete">cipher-&gt;key + 2 * sizeof(DES_key_schedule)
</span>,</td><td> </td><td class="rblock">  DES_ncbc_encrypt(in, out, len, <span class="insert">(void*)((uint8_t*)cipher-&gt;key + 2 * sizeof
(DES_key_schedule))</span>,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      IV, 0);</td><td> </td><td class="right">      IV, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  DES_ncbc_encrypt(out, in, len, <span class="delete">cipher-&gt;key</span> + <span class="delete">sizeof(DES_key_schedule),</span></td><td> </td><td class="rblock">  DES_ncbc_encrypt(out, in, len, <span class="insert">(void*)((uint8_t*)cipher-&gt;key</span> + <span class="insert">sizeof(DES</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      IV</span> + <span class="delete">8,</span> 1);</td><td> </td><td class="rblock"><span class="insert">_key_schedule)),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  DES_ncbc_encrypt(in, out, len, cipher-&gt;key, <span class="delete">IV</span> + <span class="delete">16, 0);</span></td><td> </td><td class="rblock"><span class="insert">      (void*)((uint8_t*)IV</span> + <span class="insert">8),</span> 1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">  DES_ncbc_encrypt(in, out, len, cipher-&gt;key, <span class="insert">(void*)((uint8_t*)IV</span> + <span class="insert">16), 0</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef DEBUG_CRYPTO</td><td> </td><td class="right">#ifdef DEBUG_CRYPTO</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  ssh_print_hexa("Decrypt IV after", IV, 24);</td><td> </td><td class="right">  ssh_print_hexa("Decrypt IV after", IV, 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif /* HAS_DES */</td><td> </td><td class="right">#endif /* HAS_DES */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">/* <span class="delete">the</span> table of supported ciphers */</td><td> </td><td class="rblock">/*</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"> <span class="insert">* The</span> table of supported ciphers</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"> <span class="insert">*</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"> * WARNING: If you modify crypto_struct, you must make sure the order is</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"> * correct!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static struct crypto_struct ssh_ciphertab[] = {</td><td> </td><td class="right">static struct crypto_struct ssh_ciphertab[] = {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef HAS_BLOWFISH</td><td> </td><td class="right">#ifdef HAS_BLOWFISH</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  {</td><td> </td><td class="right">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.name            =</span> "blowfish-cbc",</td><td> </td><td class="rblock">    "blowfish-cbc",</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.blocksize       =</span> 8,</td><td> </td><td class="rblock">    8,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keylen          =</span> sizeof (BF_KEY),</td><td> </td><td class="rblock">    sizeof (BF_KEY),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.key             =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keysize         =</span> 128,</td><td> </td><td class="rblock">    128,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_encrypt_key =</span> blowfish_set_key,</td><td> </td><td class="rblock">    blowfish_set_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_decrypt_key =</span> blowfish_set_key,</td><td> </td><td class="rblock">    blowfish_set_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_encrypt     =</span> blowfish_encrypt,</td><td> </td><td class="rblock">    blowfish_encrypt,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_decrypt     =</span> blowfish_decrypt</td><td> </td><td class="rblock">    blowfish_decrypt</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  },</td><td> </td><td class="right">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif /* HAS_BLOWFISH */</td><td> </td><td class="right">#endif /* HAS_BLOWFISH */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef HAS_AES</td><td> </td><td class="right">#ifdef HAS_AES</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  {</td><td> </td><td class="right">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.name            =</span> "aes128-cbc",</td><td> </td><td class="rblock">    "aes128-cbc",</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.blocksize       =</span> 16,</td><td> </td><td class="rblock">    16,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keylen          =</span> sizeof(AES_KEY),</td><td> </td><td class="rblock">    sizeof(AES_KEY),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.key             =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keysize         =</span> 128,</td><td> </td><td class="rblock">    128,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_encrypt_key =</span> aes_set_encrypt_key,</td><td> </td><td class="rblock">    aes_set_encrypt_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_decrypt_key =</span> aes_set_decrypt_key,</td><td> </td><td class="rblock">    aes_set_decrypt_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_encrypt     =</span> aes_encrypt,</td><td> </td><td class="rblock">    aes_encrypt,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_decrypt     =</span> aes_decrypt</td><td> </td><td class="rblock">    aes_decrypt</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  },</td><td> </td><td class="rblock">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  {</td><td> </td><td class="rblock">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.name            =</span> "aes192-cbc",</td><td> </td><td class="rblock">    "aes192-cbc",</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.blocksize       =</span> 16,</td><td> </td><td class="rblock">    16,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keylen          =</span> sizeof(AES_KEY),</td><td> </td><td class="rblock">    sizeof(AES_KEY),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.key             =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keysize         =</span> 192,</td><td> </td><td class="rblock">    192,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_encrypt_key =</span> aes_set_encrypt_key,</td><td> </td><td class="rblock">    aes_set_encrypt_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_decrypt_key =</span> aes_set_decrypt_key,</td><td> </td><td class="rblock">    aes_set_decrypt_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_encrypt     =</span> aes_encrypt,</td><td> </td><td class="rblock">    aes_encrypt,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_decrypt     =</span> aes_decrypt</td><td> </td><td class="rblock">    aes_decrypt</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  },</td><td> </td><td class="rblock">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  {</td><td> </td><td class="rblock">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.name            =</span> "aes256-cbc",</td><td> </td><td class="rblock">    "aes256-cbc",</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.blocksize       =</span> 16,</td><td> </td><td class="rblock">    16,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keylen          =</span> sizeof(AES_KEY),</td><td> </td><td class="rblock">    sizeof(AES_KEY),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.key             =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keysize         =</span> 256,</td><td> </td><td class="rblock">    256,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_encrypt_key =</span> aes_set_encrypt_key,</td><td> </td><td class="rblock">    aes_set_encrypt_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_decrypt_key =</span> aes_set_decrypt_key,</td><td> </td><td class="rblock">    aes_set_decrypt_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_encrypt     =</span> aes_encrypt,</td><td> </td><td class="rblock">    aes_encrypt,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_decrypt     =</span> aes_decrypt</td><td> </td><td class="rblock">    aes_decrypt</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  },</td><td> </td><td class="right">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif /* HAS_AES */</td><td> </td><td class="right">#endif /* HAS_AES */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef HAS_DES</td><td> </td><td class="right">#ifdef HAS_DES</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  {</td><td> </td><td class="right">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.name            =</span> "3des-cbc",</td><td> </td><td class="rblock">    "3des-cbc",</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.blocksize       =</span> 8,</td><td> </td><td class="rblock">    8,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keylen          =</span> sizeof(DES_key_schedule) * 3,</td><td> </td><td class="rblock">    sizeof(DES_key_schedule) * 3,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.key             =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keysize         =</span> 192,</td><td> </td><td class="rblock">    192,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_encrypt_key =</span> des3_set_key,</td><td> </td><td class="rblock">    des3_set_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_decrypt_key =</span> des3_set_key,</td><td> </td><td class="rblock">    des3_set_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_encrypt     =</span> des3_encrypt,</td><td> </td><td class="rblock">    des3_encrypt,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_decrypt     =</span> des3_decrypt</td><td> </td><td class="rblock">    des3_decrypt</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  },</td><td> </td><td class="rblock">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  {</td><td> </td><td class="rblock">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.name            =</span> "3des-cbc-ssh1",</td><td> </td><td class="rblock">    "3des-cbc-ssh1",</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.blocksize       =</span> 8,</td><td> </td><td class="rblock">    8,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keylen          =</span> sizeof(DES_key_schedule) * 3,</td><td> </td><td class="rblock">    sizeof(DES_key_schedule) * 3,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.key             =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keysize         =</span> 192,</td><td> </td><td class="rblock">    192,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_encrypt_key =</span> des3_set_key,</td><td> </td><td class="rblock">    des3_set_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_decrypt_key =</span> des3_set_key,</td><td> </td><td class="rblock">    des3_set_key,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_encrypt     =</span> des3_1_encrypt,</td><td> </td><td class="rblock">    des3_1_encrypt,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_decrypt     =</span> des3_1_decrypt</td><td> </td><td class="rblock">    des3_1_decrypt</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  },</td><td> </td><td class="right">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif /* HAS_DES */</td><td> </td><td class="right">#endif /* HAS_DES */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  {</td><td> </td><td class="right">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.name            =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.blocksize       =</span> 0,</td><td> </td><td class="rblock">    0,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keylen          =</span> 0,</td><td> </td><td class="rblock">    0,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.key             =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.keysize         =</span> 0,</td><td> </td><td class="rblock">    0,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_encrypt_key =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.set_decrypt_key =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_encrypt     =</span> NULL,</td><td> </td><td class="rblock">    NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">.cbc_decrypt     =</span> NULL</td><td> </td><td class="rblock">    NULL</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">};</td><td> </td><td class="right">};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif /* OPENSSL_CRYPTO */</td><td> </td><td class="right">#endif /* OPENSSL_CRYPTO */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/* it allocates a new cipher structure based on its offset into the global 
table */</td><td> </td><td class="right">/* it allocates a new cipher structure based on its offset into the global 
table */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static struct crypto_struct *cipher_new(int offset) {</td><td> </td><td class="right">static struct crypto_struct *cipher_new(int offset) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  struct crypto_struct *cipher = NULL;</td><td> </td><td class="right">  struct crypto_struct *cipher = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  cipher = malloc(sizeof(struct crypto_struct));</td><td> </td><td class="right">  cipher = malloc(sizeof(struct crypto_struct));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (cipher == NULL) {</td><td> </td><td class="right">  if (cipher == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 766</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 773</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#elif defined HAVE_LIBCRYPTO</td><td> </td><td class="right">#elif defined HAVE_LIBCRYPTO</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* destroy the key */</td><td> </td><td class="right">    /* destroy the key */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    memset(cipher-&gt;key, 0, cipher-&gt;keylen);</td><td> </td><td class="right">    memset(cipher-&gt;key, 0, cipher-&gt;keylen);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    SAFE_FREE(cipher-&gt;key);</td><td> </td><td class="right">    SAFE_FREE(cipher-&gt;key);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  SAFE_FREE(cipher);</td><td> </td><td class="right">  SAFE_FREE(cipher);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">CRYPTO</span> *crypto_new(void) {</td><td> </td><td class="rblock"><span class="insert">struct ssh_crypto_struct</span> *crypto_new(void) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">CRYPTO</span> *crypto;</td><td> </td><td class="rblock">       <span class="insert">struct ssh_crypto_struct</span> *crypto;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  crypto = malloc(sizeof(<span class="delete">CRYPTO</span>));</td><td> </td><td class="rblock">  crypto = malloc(sizeof(<span class="insert">struct ssh_crypto_struct</span>));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (crypto == NULL) {</td><td> </td><td class="right">  if (crypto == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return NULL;</td><td> </td><td class="right">    return NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">  <span class="insert">ZERO_STRUCTP(crypto);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">memset(crypto, 0, sizeof(CRYPTO));</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return crypto;</td><td> </td><td class="right">  return crypto;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void crypto_free(<span class="delete">CRYPTO</span> *crypto){</td><td> </td><td class="rblock">void crypto_free(<span class="insert">struct ssh_crypto_struct</span> *crypto){</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (crypto == NULL) {</td><td> </td><td class="right">  if (crypto == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return;</td><td> </td><td class="right">    return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  SAFE_FREE(crypto-&gt;server_pubkey);</td><td> </td><td class="right">  SAFE_FREE(crypto-&gt;server_pubkey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  cipher_free(crypto-&gt;in_cipher);</td><td> </td><td class="right">  cipher_free(crypto-&gt;in_cipher);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  cipher_free(crypto-&gt;out_cipher);</td><td> </td><td class="right">  cipher_free(crypto-&gt;out_cipher);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  bignum_free(crypto-&gt;e);</td><td> </td><td class="right">  bignum_free(crypto-&gt;e);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 801</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 806</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  bignum_free(crypto-&gt;x);</td><td> </td><td class="right">  bignum_free(crypto-&gt;x);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  bignum_free(crypto-&gt;y);</td><td> </td><td class="right">  bignum_free(crypto-&gt;y);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  bignum_free(crypto-&gt;k);</td><td> </td><td class="right">  bignum_free(crypto-&gt;k);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  /* lot of other things */</td><td> </td><td class="right">  /* lot of other things */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  /* i'm lost in my own code. good work */</td><td> </td><td class="right">  /* i'm lost in my own code. good work */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  memset(crypto,0,sizeof(*crypto));</td><td> </td><td class="right">  memset(crypto,0,sizeof(*crypto));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  SAFE_FREE(crypto);</td><td> </td><td class="right">  SAFE_FREE(crypto);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static int crypt_set_algorithms2(<span class="delete">SSH_SESSION *</span>session){</td><td> </td><td class="rblock">static int crypt_set_algorithms2(<span class="insert">ssh_session </span>session){</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  const char *wanted;</td><td> </td><td class="right">  const char *wanted;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int i = 0;</td><td> </td><td class="right">  int i = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  /* we must scan the kex entries to find crypto algorithms and set their a
ppropriate structure */</td><td> </td><td class="right">  /* we must scan the kex entries to find crypto algorithms and set their a
ppropriate structure */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  /* out */</td><td> </td><td class="right">  /* out */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  wanted = session-&gt;client_kex.methods[SSH_CRYPT_C_S];</td><td> </td><td class="right">  wanted = session-&gt;client_kex.methods[SSH_CRYPT_C_S];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  while (ssh_ciphertab[i].name &amp;&amp; strcmp(wanted, ssh_ciphertab[i].name)) {</td><td> </td><td class="right">  while (ssh_ciphertab[i].name &amp;&amp; strcmp(wanted, ssh_ciphertab[i].name)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    i++;</td><td> </td><td class="right">    i++;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 858</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 863</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (strstr(session-&gt;client_kex.methods[SSH_COMP_C_S], "zlib")) {</td><td> </td><td class="right">  if (strstr(session-&gt;client_kex.methods[SSH_COMP_C_S], "zlib")) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    session-&gt;next_crypto-&gt;do_compress_out = 1;</td><td> </td><td class="right">    session-&gt;next_crypto-&gt;do_compress_out = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (strstr(session-&gt;client_kex.methods[SSH_COMP_S_C], "zlib")) {</td><td> </td><td class="right">  if (strstr(session-&gt;client_kex.methods[SSH_COMP_S_C], "zlib")) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    session-&gt;next_crypto-&gt;do_compress_in = 1;</td><td> </td><td class="right">    session-&gt;next_crypto-&gt;do_compress_in = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return SSH_OK;</td><td> </td><td class="right">  return SSH_OK;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static int crypt_set_algorithms1(<span class="delete">SSH_SESSION *</span>session) {</td><td> </td><td class="rblock">static int crypt_set_algorithms1(<span class="insert">ssh_session </span>session) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int i = 0;</td><td> </td><td class="right">  int i = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  /* right now, we force 3des-cbc to be taken */</td><td> </td><td class="right">  /* right now, we force 3des-cbc to be taken */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  while (ssh_ciphertab[i].name &amp;&amp; strcmp(ssh_ciphertab[i].name,</td><td> </td><td class="right">  while (ssh_ciphertab[i].name &amp;&amp; strcmp(ssh_ciphertab[i].name,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        "3des-cbc-ssh1")) {</td><td> </td><td class="right">        "3des-cbc-ssh1")) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    i++;</td><td> </td><td class="right">    i++;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (ssh_ciphertab[i].name == NULL) {</td><td> </td><td class="right">  if (ssh_ciphertab[i].name == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    ssh_set_error(session, SSH_FATAL, "cipher 3des-cbc-ssh1 not found!");</td><td> </td><td class="right">    ssh_set_error(session, SSH_FATAL, "cipher 3des-cbc-ssh1 not found!");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 887</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 892</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  session-&gt;next_crypto-&gt;in_cipher = cipher_new(i);</td><td> </td><td class="right">  session-&gt;next_crypto-&gt;in_cipher = cipher_new(i);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;next_crypto-&gt;in_cipher == NULL) {</td><td> </td><td class="right">  if (session-&gt;next_crypto-&gt;in_cipher == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    ssh_set_error(session, SSH_FATAL, "No space left");</td><td> </td><td class="right">    ssh_set_error(session, SSH_FATAL, "No space left");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return SSH_ERROR;</td><td> </td><td class="right">    return SSH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return SSH_OK;</td><td> </td><td class="right">  return SSH_OK;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int crypt_set_algorithms(<span class="delete">SSH_SESSION *</span>session) {</td><td> </td><td class="rblock">int crypt_set_algorithms(<span class="insert">ssh_session </span>session) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return (session-&gt;version == 1) ? crypt_set_algorithms1(session) :</td><td> </td><td class="right">  return (session-&gt;version == 1) ? crypt_set_algorithms1(session) :</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    crypt_set_algorithms2(session);</td><td> </td><td class="right">    crypt_set_algorithms2(session);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// TODO Obviously too much cut and paste here</td><td> </td><td class="right">// TODO Obviously too much cut and paste here</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int crypt_set_algorithms_server(<span class="delete">SSH_SESSION *</span>session){</td><td> </td><td class="rblock">int crypt_set_algorithms_server(<span class="insert">ssh_session </span>session){</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    char *server = NULL;</td><td> </td><td class="right">    char *server = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    char *client = NULL;</td><td> </td><td class="right">    char *client = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    char *match = NULL;</td><td> </td><td class="right">    char *match = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    int i = 0;</td><td> </td><td class="right">    int i = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* we must scan the kex entries to find crypto algorithms and set their
 appropriate structure */</td><td> </td><td class="right">    /* we must scan the kex entries to find crypto algorithms and set their
 appropriate structure */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    enter_function();</td><td> </td><td class="right">    enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* out */</td><td> </td><td class="right">    /* out */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    server = session-&gt;server_kex.methods[SSH_CRYPT_S_C];</td><td> </td><td class="right">    server = session-&gt;server_kex.methods[SSH_CRYPT_S_C];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    client = session-&gt;client_kex.methods[SSH_CRYPT_S_C];</td><td> </td><td class="right">    client = session-&gt;client_kex.methods[SSH_CRYPT_S_C];</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 28 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>106 lines changed or deleted</i></th><th><i> </i></th><th><i>115 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
