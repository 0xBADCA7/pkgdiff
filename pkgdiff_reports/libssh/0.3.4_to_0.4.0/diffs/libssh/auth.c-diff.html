<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux aponomarenko 3.2.0-29-generic #46-Ubuntu SMP Fri Jul 27 17:03:23 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 3.1.8 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.2 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 0.6.5 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: auth.c - auth.c</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;auth.c&nbsp;</th><th> </th><th>&nbsp;auth.c&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 35</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 35</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;stdlib.h&gt;</td><td> </td><td class="right">#include &lt;stdlib.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;stdio.h&gt;</td><td> </td><td class="right">#include &lt;stdio.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;string.h&gt;</td><td> </td><td class="right">#include &lt;string.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef _WIN32</td><td> </td><td class="right">#ifndef _WIN32</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;arpa/inet.h&gt;</td><td> </td><td class="right">#include &lt;arpa/inet.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "libssh/priv.h"</td><td> </td><td class="right">#include "libssh/priv.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "libssh/ssh2.h"</td><td> </td><td class="right">#include "libssh/ssh2.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/buffer.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/agent.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/keyfiles.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/packet.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/session.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "libssh/keys.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/** \defgroup ssh_auth SSH Authentication functions</td><td> </td><td class="right">/** \defgroup ssh_auth SSH Authentication functions</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * \brief functions to authenticate to servers</td><td> </td><td class="right"> * \brief functions to authenticate to servers</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/** \addtogroup ssh_auth</td><td> </td><td class="right">/** \addtogroup ssh_auth</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @{ */</td><td> </td><td class="right"> * @{ */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static int ask_userauth(<span class="delete">SSH_SESSION *</span>session) {</td><td> </td><td class="rblock">static int ask_userauth(<span class="insert">ssh_session </span>session) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = 0;</td><td> </td><td class="right">  int rc = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;auth_service_asked) {</td><td> </td><td class="right">  if (session-&gt;auth_service_asked) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    rc = 0;</td><td> </td><td class="right">    rc = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } else if (ssh_service_request(session,"ssh-userauth")) {</td><td> </td><td class="right">  } else if (ssh_service_request(session,"ssh-userauth")) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    rc = -1;</td><td> </td><td class="right">    rc = -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } else {</td><td> </td><td class="right">  } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    session-&gt;auth_service_asked++;</td><td> </td><td class="right">    session-&gt;auth_service_asked++;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  leave_function();</td><td> </td><td class="right">  leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return rc;</td><td> </td><td class="right">  return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static int wait_auth_status(<span class="delete">SSH_SESSION *</span>session, int kbdint) {</td><td> </td><td class="rblock">static int wait_auth_status(<span class="insert">ssh_session </span>session, int kbdint) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  char *auth_methods = NULL;</td><td> </td><td class="right">  char *auth_methods = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *</span>auth;</td><td> </td><td class="rblock">  <span class="insert">ssh_string </span>auth;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int cont = 1;</td><td> </td><td class="right">  int cont = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  u<span class="delete">8</span> partial = 0;</td><td> </td><td class="rblock">  u<span class="insert">int8_t</span> partial = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  while (cont) {</td><td> </td><td class="right">  while (cont) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (packet_read(session) != SSH_OK) {</td><td> </td><td class="right">    if (packet_read(session) != SSH_OK) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      break;</td><td> </td><td class="right">      break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (packet_translate(session) != SSH_OK) {</td><td> </td><td class="right">    if (packet_translate(session) != SSH_OK) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      break;</td><td> </td><td class="right">      break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 142</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 148</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          cont = 0;</td><td> </td><td class="right">          cont = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          break;</td><td> </td><td class="right">          break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        }</td><td> </td><td class="right">        }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        /* continue through success */</td><td> </td><td class="right">        /* continue through success */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      case SSH2_MSG_USERAUTH_SUCCESS:</td><td> </td><td class="right">      case SSH2_MSG_USERAUTH_SUCCESS:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        rc = SSH_AUTH_SUCCESS;</td><td> </td><td class="right">        rc = SSH_AUTH_SUCCESS;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        cont = 0;</td><td> </td><td class="right">        cont = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        break;</td><td> </td><td class="right">        break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      case SSH2_MSG_USERAUTH_BANNER:</td><td> </td><td class="right">      case SSH2_MSG_USERAUTH_BANNER:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        {</td><td> </td><td class="right">        {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          <span class="delete">STRING *</span>banner;</td><td> </td><td class="rblock">          <span class="insert">ssh_string </span>banner;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          banner = buffer_get_ssh_string(session-&gt;in_buffer);</td><td> </td><td class="right">          banner = buffer_get_ssh_string(session-&gt;in_buffer);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          if (banner == NULL) {</td><td> </td><td class="right">          if (banner == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            ssh_log(session, SSH_LOG_PACKET,</td><td> </td><td class="right">            ssh_log(session, SSH_LOG_PACKET,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                "The banner message was invalid. Continuing though\n");</td><td> </td><td class="right">                "The banner message was invalid. Continuing though\n");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            break;</td><td> </td><td class="right">            break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          }</td><td> </td><td class="right">          }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ssh_log(session, SSH_LOG_PACKET,</td><td> </td><td class="right">          ssh_log(session, SSH_LOG_PACKET,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              "Received a message banner\n");</td><td> </td><td class="right">              "Received a message banner\n");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          string_free(session-&gt;banner); /* erase the older one */</td><td> </td><td class="right">          string_free(session-&gt;banner); /* erase the older one */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 166</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 172</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      default:</td><td> </td><td class="right">      default:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        packet_parse(session);</td><td> </td><td class="right">        packet_parse(session);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        break;</td><td> </td><td class="right">        break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  leave_function();</td><td> </td><td class="right">  leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return rc;</td><td> </td><td class="right">  return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int ssh_auth_list(<span class="delete">SSH_SESSION *</span>session) {</td><td> </td><td class="rblock">int ssh_auth_list(<span class="insert">ssh_session </span>session) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session == NULL) {</td><td> </td><td class="right">  if (session == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return -1;</td><td> </td><td class="right">    return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return session-&gt;auth_methods;</td><td> </td><td class="right">  return session-&gt;auth_methods;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int ssh_userauth_list(<span class="delete">SSH_SESSION *</span>session, const char *username) {</td><td> </td><td class="rblock">int ssh_userauth_list(<span class="insert">ssh_session </span>session, const char *username) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session == NULL || username == NULL) {</td><td> </td><td class="right">  if (session == NULL || username == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return SSH_AUTH_ERROR;</td><td> </td><td class="right">    return SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;auth_methods == 0) {</td><td> </td><td class="right">  if (session-&gt;auth_methods == 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    ssh_userauth_none(session, username);</td><td> </td><td class="right">    ssh_userauth_none(session, username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return ssh_auth_list(session);</td><td> </td><td class="right">  return ssh_auth_list(session);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 203</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 209</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param username      The username to authenticate. You can specify NULL 
if</td><td> </td><td class="right"> * @param username      The username to authenticate. You can specify NULL 
if</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                      ssh_option_set_username() has been used. You cannot
 try</td><td> </td><td class="right"> *                      ssh_option_set_username() has been used. You cannot
 try</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                      two different logins in a row.</td><td> </td><td class="right"> *                      two different logins in a row.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @returns SSH_AUTH_ERROR:   A serious error happened.\n</td><td> </td><td class="right"> * @returns SSH_AUTH_ERROR:   A serious error happened.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_DENIED:  Authentication failed: use another method\n</td><td> </td><td class="right"> *          SSH_AUTH_DENIED:  Authentication failed: use another method\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td> </td><td class="right"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            have to use another method\n</td><td> </td><td class="right"> *                            have to use another method\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_SUCCESS: Authentication success</td><td> </td><td class="right"> *          SSH_AUTH_SUCCESS: Authentication success</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int <span class="delete">ssh_userauth_none(SSH_SESSION *session,</span> const char *username) {</td><td> </td><td class="rblock">int <span class="insert">ssh_userauth_none(ssh_session session,</span> const char *username) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *user</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string user</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *service</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string service</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *method</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string method</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef WITH_SSH1</td><td> </td><td class="right">#ifdef WITH_SSH1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;version == 1) {</td><td> </td><td class="right">  if (session-&gt;version == 1) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    ssh_userauth1_none(session, username);</td><td> </td><td class="right">    ssh_userauth1_none(session, username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (username == NULL) {</td><td> </td><td class="right">  if (username == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if <span class="delete">(session-&gt;options-&gt;username</span> == NULL) {</td><td> </td><td class="rblock">    if <span class="insert">(session-&gt;username</span> == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if <span class="delete">(ssh_options_default_username(session-&gt;options)</span> &lt; 0) {</td><td> </td><td class="rblock">      if <span class="insert">(ssh_options_set(session, SSH_OPTIONS_USER, NULL)</span> &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        leave_function();</td><td> </td><td class="right">        leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        return rc;</td><td> </td><td class="right">        return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      }</td><td> </td><td class="right">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    user = string_from_char(session-&gt;<span class="delete">options-&gt;</span>username);</td><td> </td><td class="rblock">    user = string_from_char(session-&gt;username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } else {</td><td> </td><td class="right">  } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    user = string_from_char(username);</td><td> </td><td class="right">    user = string_from_char(username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (user == NULL) {</td><td> </td><td class="right">  if (user == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (ask_userauth(session) &lt; 0) {</td><td> </td><td class="right">  if (ask_userauth(session) &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 307</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 313</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            method.\n</td><td> </td><td class="right"> *                            method.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td> </td><td class="right"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            have to use another method.\n</td><td> </td><td class="right"> *                            have to use another method.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_SUCCESS: The public key is accepted, you want now to u
se</td><td> </td><td class="right"> *          SSH_AUTH_SUCCESS: The public key is accepted, you want now to u
se</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            ssh_userauth_pubkey().</td><td> </td><td class="right"> *                            ssh_userauth_pubkey().</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see publickey_from_file()</td><td> </td><td class="right"> * @see publickey_from_file()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see privatekey_from_file()</td><td> </td><td class="right"> * @see privatekey_from_file()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_pubkey()</td><td> </td><td class="right"> * @see ssh_userauth_pubkey()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int <span class="delete">ssh_userauth_offer_pubkey(SSH_SESSION *session,</span> const char *username,</td><td> </td><td class="rblock">int <span class="insert">ssh_userauth_offer_pubkey(ssh_session session,</span> const char *username,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int type, <span class="delete">STRING *publickey)</span> {</td><td> </td><td class="rblock">    int type, <span class="insert">ssh_string publickey)</span> {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *user</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string user</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *service</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string service</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *method</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string method</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *algo</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string algo</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef WITH_SSH1</td><td> </td><td class="right">#ifdef WITH_SSH1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;version == 1) {</td><td> </td><td class="right">  if (session-&gt;version == 1) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    ssh_userauth1_offer_pubkey(session, username, type, publickey);</td><td> </td><td class="right">    ssh_userauth1_offer_pubkey(session, username, type, publickey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (username == NULL) {</td><td> </td><td class="right">  if (username == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if <span class="delete">(session-&gt;options-&gt;username</span> == NULL) {</td><td> </td><td class="rblock">    if <span class="insert">(session-&gt;username</span> == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if <span class="delete">(ssh_options_default_username(session-&gt;options)</span> &lt; 0) {</td><td> </td><td class="rblock">      if <span class="insert">(ssh_options_set(session, SSH_OPTIONS_USER, NULL)</span> &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        leave_function();</td><td> </td><td class="right">        leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        return rc;</td><td> </td><td class="right">        return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      }</td><td> </td><td class="right">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    user = string_from_char(session-&gt;<span class="delete">options-&gt;</span>username);</td><td> </td><td class="rblock">    user = string_from_char(session-&gt;username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } else {</td><td> </td><td class="right">  } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    user = string_from_char(username);</td><td> </td><td class="right">    user = string_from_char(username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (user == NULL) {</td><td> </td><td class="right">  if (user == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (ask_userauth(session) &lt; 0) {</td><td> </td><td class="right">  if (ask_userauth(session) &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 419</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 425</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_DENIED:  Authentication failed: use another method.\n</td><td> </td><td class="right"> *          SSH_AUTH_DENIED:  Authentication failed: use another method.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td> </td><td class="right"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            have to use another method.\n</td><td> </td><td class="right"> *                            have to use another method.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_SUCCESS: Authentication successful.</td><td> </td><td class="right"> *          SSH_AUTH_SUCCESS: Authentication successful.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see publickey_from_file()</td><td> </td><td class="right"> * @see publickey_from_file()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see privatekey_from_file()</td><td> </td><td class="right"> * @see privatekey_from_file()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see privatekey_free()</td><td> </td><td class="right"> * @see privatekey_free()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_offer_pubkey()</td><td> </td><td class="right"> * @see ssh_userauth_offer_pubkey()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int <span class="delete">ssh_userauth_pubkey(SSH_SESSION *session,</span> const char *username,</td><td> </td><td class="rblock">int <span class="insert">ssh_userauth_pubkey(ssh_session session,</span> const char *username,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">STRING *publickey, PRIVATE_KEY *privatekey)</span> {</td><td> </td><td class="rblock">    <span class="insert">ssh_string publickey, ssh_private_key privatekey)</span> {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *user</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string user</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *service</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string service</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *method</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string method</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *algo</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string algo</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *sign</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string sign</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#if 0</td><td> </td><td class="right">#if 0</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;version == 1) {</td><td> </td><td class="right">  if (session-&gt;version == 1) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return ssh_userauth1_pubkey(session, username, publickey, privatekey);</td><td> </td><td class="right">    return ssh_userauth1_pubkey(session, username, publickey, privatekey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (username == NULL) {</td><td> </td><td class="right">  if (username == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if <span class="delete">(session-&gt;options-&gt;username</span> == NULL) {</td><td> </td><td class="rblock">    if <span class="insert">(session-&gt;username</span> == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if <span class="delete">(ssh_options_default_username(session-&gt;options)</span> &lt; 0) {</td><td> </td><td class="rblock">      if <span class="insert">(ssh_options_set(session, SSH_OPTIONS_USER, NULL)</span> &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        leave_function();</td><td> </td><td class="right">        leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        return rc;</td><td> </td><td class="right">        return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      }</td><td> </td><td class="right">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    user = string_from_char(session-&gt;<span class="delete">options-&gt;</span>username);</td><td> </td><td class="rblock">    user = string_from_char(session-&gt;username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } else {</td><td> </td><td class="right">  } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    user = string_from_char(username);</td><td> </td><td class="right">    user = string_from_char(username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (user == NULL) {</td><td> </td><td class="right">  if (user == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (ask_userauth(session) &lt; 0) {</td><td> </td><td class="right">  if (ask_userauth(session) &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 538</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 544</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_DENIED:  Authentication failed: use another method.\n</td><td> </td><td class="right"> *          SSH_AUTH_DENIED:  Authentication failed: use another method.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td> </td><td class="right"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            have to use another method.\n</td><td> </td><td class="right"> *                            have to use another method.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_SUCCESS: Authentication successful.</td><td> </td><td class="right"> *          SSH_AUTH_SUCCESS: Authentication successful.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see publickey_from_file()</td><td> </td><td class="right"> * @see publickey_from_file()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see privatekey_from_file()</td><td> </td><td class="right"> * @see privatekey_from_file()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see privatekey_free()</td><td> </td><td class="right"> * @see privatekey_free()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_offer_pubkey()</td><td> </td><td class="right"> * @see ssh_userauth_offer_pubkey()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int <span class="delete">ssh_userauth_agent_pubkey(SSH_SESSION *session,</span> const char *username,</td><td> </td><td class="rblock">int <span class="insert">ssh_userauth_agent_pubkey(ssh_session session,</span> const char *username,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">PUBLIC_KEY *publickey)</span> {</td><td> </td><td class="rblock">    <span class="insert">ssh_public_key publickey)</span> {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *user</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string user</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *service</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string service</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *method</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string method</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *algo</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string algo</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *key</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string key</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *sign</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string sign</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (! agent_is_running(session)) {</td><td> </td><td class="right">  if (! agent_is_running(session)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (username == NULL) {</td><td> </td><td class="right">  if (username == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if <span class="delete">(session-&gt;options-&gt;username</span> == NULL) {</td><td> </td><td class="rblock">    if <span class="insert">(session-&gt;username</span> == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if <span class="delete">(ssh_options_default_username(session-&gt;options)</span> &lt; 0) {</td><td> </td><td class="rblock">      if <span class="insert">(ssh_options_set(session, SSH_OPTIONS_USER, NULL)</span> &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        leave_function();</td><td> </td><td class="right">        leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        return rc;</td><td> </td><td class="right">        return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      }</td><td> </td><td class="right">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    user = string_from_char(session-&gt;<span class="delete">options-&gt;</span>username);</td><td> </td><td class="rblock">    user = string_from_char(session-&gt;username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } else {</td><td> </td><td class="right">  } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    user = string_from_char(username);</td><td> </td><td class="right">    user = string_from_char(username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (user == NULL) {</td><td> </td><td class="right">  if (user == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (ask_userauth(session) &lt; 0) {</td><td> </td><td class="right">  if (ask_userauth(session) &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 663</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 669</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @returns SSH_AUTH_ERROR:   A serious error happened.\n</td><td> </td><td class="right"> * @returns SSH_AUTH_ERROR:   A serious error happened.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_DENIED:  Authentication failed: use another method.\n</td><td> </td><td class="right"> *          SSH_AUTH_DENIED:  Authentication failed: use another method.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td> </td><td class="right"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            have to use another method.\n</td><td> </td><td class="right"> *                            have to use another method.\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_SUCCESS: Authentication successful.</td><td> </td><td class="right"> *          SSH_AUTH_SUCCESS: Authentication successful.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_kbdint()</td><td> </td><td class="right"> * @see ssh_userauth_kbdint()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see BURN_STRING</td><td> </td><td class="right"> * @see BURN_STRING</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int ssh_userauth_password(<span class="delete">SSH_SESSION *</span>session, const char *username,</td><td> </td><td class="rblock">int ssh_userauth_password(<span class="insert">ssh_session </span>session, const char *username,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    const char *password) {</td><td> </td><td class="right">    const char *password) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *user</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string user</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *service</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string service</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *method</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string method</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *pwd</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string pwd</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef WITH_SSH1</td><td> </td><td class="right">#ifdef WITH_SSH1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;version == 1) {</td><td> </td><td class="right">  if (session-&gt;version == 1) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    rc = ssh_userauth1_password(session, username, password);</td><td> </td><td class="right">    rc = ssh_userauth1_password(session, username, password);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (username == NULL) {</td><td> </td><td class="right">  if (username == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if <span class="delete">(session-&gt;options-&gt;username</span> == NULL) {</td><td> </td><td class="rblock">    if <span class="insert">(session-&gt;username</span> == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if <span class="delete">(ssh_options_default_username(session-&gt;options)</span> &lt; 0) {</td><td> </td><td class="rblock">      if <span class="insert">(ssh_options_set(session, SSH_OPTIONS_USER, NULL)</span> &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        leave_function();</td><td> </td><td class="right">        leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        return rc;</td><td> </td><td class="right">        return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      }</td><td> </td><td class="right">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    user = string_from_char(session-&gt;<span class="delete">options-&gt;</span>username);</td><td> </td><td class="rblock">    user = string_from_char(session-&gt;username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } else {</td><td> </td><td class="right">  } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    user = string_from_char(username);</td><td> </td><td class="right">    user = string_from_char(username);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (user == NULL) {</td><td> </td><td class="right">  if (user == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (ask_userauth(session) &lt; 0) {</td><td> </td><td class="right">  if (ask_userauth(session) &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l9" /><small>skipping to change at</small><em> line 752</em></th><th> </th><th><a name="part-r9" /><small>skipping to change at</small><em> line 758</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_free(user);</td><td> </td><td class="right">  string_free(user);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_free(service);</td><td> </td><td class="right">  string_free(service);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_free(method);</td><td> </td><td class="right">  string_free(method);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_burn(pwd);</td><td> </td><td class="right">  string_burn(pwd);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_free(pwd);</td><td> </td><td class="right">  string_free(pwd);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  leave_function();</td><td> </td><td class="right">  leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return rc;</td><td> </td><td class="right">  return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static struct <span class="delete">keys_struct</span> keytab[] = {</td><td> </td><td class="rblock"><span class="insert">#ifdef _MSC_VER</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static const char privKey_1[] = "SSH_DIR/identity";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static const char pubKey_1[] = "SSH_DIR/identity.pub";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static const char privKey_2[] = "SSH_DIR/id_dsa";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static const char pubKey_2[] = "SSH_DIR/id_dsa.pub";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static const char privKey_3[] = "SSH_DIR/id_rsa";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static const char pubKey_3[] = "SSH_DIR/id_rsa.pub";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">/** Used different var to allow const char[] declaration */</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static struct ssh_keys_struct keytab[] = {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  { privKey_1, pubKey_1},</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  { privKey_2, pubKey_2},</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  { privKey_3, pubKey_3},</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  {0}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">};</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#else</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">/* This requires GCC extensions */</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">static struct <span class="insert">ssh_keys_struct</span> keytab[] = {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  {</td><td> </td><td class="right">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    .privatekey = <span class="delete">"%s/.ssh/identity",</span></td><td> </td><td class="rblock">    .privatekey = <span class="insert">"SSH_DIR/identity",</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    .publickey = <span class="delete">"%s/.ssh/identity.pub"</span></td><td> </td><td class="rblock">    .publickey = <span class="insert">"SSH_DIR/identity.pub"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  },</td><td> </td><td class="right">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  {</td><td> </td><td class="right">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    .privatekey = <span class="delete">"%s/.ssh/id_dsa",</span></td><td> </td><td class="rblock">    .privatekey = <span class="insert">"SSH_DIR/id_dsa",</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    .publickey = <span class="delete">"%s/.ssh/id_dsa.pub",</span></td><td> </td><td class="rblock">    .publickey = <span class="insert">"SSH_DIR/id_dsa.pub",</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  },</td><td> </td><td class="right">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  {</td><td> </td><td class="right">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    .privatekey = <span class="delete">"%s/.ssh/id_rsa",</span></td><td> </td><td class="rblock">    .privatekey = <span class="insert">"SSH_DIR/id_rsa",</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    .publickey = <span class="delete">"%s/.ssh/id_rsa.pub",</span></td><td> </td><td class="rblock">    .publickey = <span class="insert">"SSH_DIR/id_rsa.pub",</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  },</td><td> </td><td class="right">  },</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  {</td><td> </td><td class="right">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    .privatekey = NULL,</td><td> </td><td class="right">    .privatekey = NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    .publickey = NULL</td><td> </td><td class="right">    .publickey = NULL</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">};</td><td> </td><td class="right">};</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">#endif</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">/* this function initialy was in the client */</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">/* but the fools are the ones who never change mind */</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/**</td><td> </td><td class="right">/**</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @brief Tries to automaticaly authenticate with public key and "none"</td><td> </td><td class="right"> * @brief Tries to automaticaly authenticate with public key and "none"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * It may fail, for instance it doesn't ask for a password and uses a defau
lt</td><td> </td><td class="right"> * It may fail, for instance it doesn't ask for a password and uses a defau
lt</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * asker for passphrases (in case the private key is encrypted).</td><td> </td><td class="right"> * asker for passphrases (in case the private key is encrypted).</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param session       The ssh session to authenticate with.</td><td> </td><td class="right"> * @param session       The ssh session to authenticate with.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param passphrase    Use this passphrase to unlock the privatekey. Use N
ULL</td><td> </td><td class="right"> * @param passphrase    Use this passphrase to unlock the privatekey. Use N
ULL</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l10" /><small>skipping to change at</small><em> line 794</em></th><th> </th><th><a name="part-r10" /><small>skipping to change at</small><em> line 814</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                      should be asked.</td><td> </td><td class="right"> *                      should be asked.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @returns SSH_AUTH_ERROR:   A serious error happened\n</td><td> </td><td class="right"> * @returns SSH_AUTH_ERROR:   A serious error happened\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_DENIED:  Authentication failed: use another method\n</td><td> </td><td class="right"> *          SSH_AUTH_DENIED:  Authentication failed: use another method\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td> </td><td class="right"> *          SSH_AUTH_PARTIAL: You've been partially authenticated, you stil
l</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            have to use another method\n</td><td> </td><td class="right"> *                            have to use another method\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_SUCCESS: Authentication success</td><td> </td><td class="right"> *          SSH_AUTH_SUCCESS: Authentication success</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_kbdint()</td><td> </td><td class="right"> * @see ssh_userauth_kbdint()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_password()</td><td> </td><td class="right"> * @see ssh_userauth_password()</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> * @see ssh_options_set<span class="delete">_identity</span>()</td><td> </td><td class="rblock"> * @see ssh_options_set()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int <span class="delete">ssh_userauth_autopubkey(SSH_SESSION *session,</span> const char *passphrase) {</td><td> </td><td class="rblock">int <span class="insert">ssh_userauth_autopubkey(ssh_session session,</span> const char *passphrase) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  struct <span class="delete">public_key_struct</span> *publickey;</td><td> </td><td class="rblock">  struct <span class="insert">ssh_public_key_struct</span> *publickey;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *pubkey;</span></td><td> </td><td class="rblock">  <span class="insert">ssh_string pubkey;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">  PRIVATE_KEY *privkey;</span></td><td> </td><td class="rblock"><span class="insert">  ssh_private_key privkey;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  char *privkeyfile = NULL;</td><td> </td><td class="right">  char *privkeyfile = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  char *id = NULL;</td><td> </td><td class="right">  char *id = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  size_t size;</td><td> </td><td class="right">  size_t size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  unsigned int i = 0;</td><td> </td><td class="right">  unsigned int i = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int type = 0;</td><td> </td><td class="right">  int type = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc;</td><td> </td><td class="right">  int rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  /* Always test none authentication */</td><td> </td><td class="right">  /* Always test none authentication */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  rc = ssh_userauth_none(session, NULL);</td><td> </td><td class="right">  rc = ssh_userauth_none(session, NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (rc == SSH_AUTH_ERROR || rc == SSH_AUTH_SUCCESS) {</td><td> </td><td class="right">  if (rc == SSH_AUTH_ERROR || rc == SSH_AUTH_SUCCESS) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    leave_function();</td><td> </td><td class="right">    leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return rc;</td><td> </td><td class="right">    return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  /* Try authentication with ssh-agent first */</td><td> </td><td class="right">  /* Try authentication with ssh-agent first */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef _WIN32</td><td> </td><td class="right">#ifndef _WIN32</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (agent_is_running(session)) {</td><td> </td><td class="right">  if (agent_is_running(session)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    ssh_log(session, SSH_LOG_RARE,</td><td> </td><td class="right">    ssh_log(session, SSH_LOG_RARE,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        "Trying to authenticate with SSH agent <span class="delete">keys");</span></td><td> </td><td class="rblock">        "Trying to authenticate with SSH agent <span class="insert">keys as user: %s",</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        session-&gt;username);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    for (publickey = agent_get_first_ident(session, &amp;privkeyfile);</td><td> </td><td class="right">    for (publickey = agent_get_first_ident(session, &amp;privkeyfile);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        publickey != NULL;</td><td> </td><td class="right">        publickey != NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        publickey = agent_get_next_ident(session, &amp;privkeyfile)) {</td><td> </td><td class="right">        publickey = agent_get_next_ident(session, &amp;privkeyfile)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ssh_log(session, SSH_LOG_RARE, "Trying identity %s", privkeyfile);</td><td> </td><td class="right">      ssh_log(session, SSH_LOG_RARE, "Trying identity %s", privkeyfile);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      pubkey = publickey_to_string(publickey);</td><td> </td><td class="right">      pubkey = publickey_to_string(publickey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      if (pubkey) {</td><td> </td><td class="right">      if (pubkey) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        rc = ssh_userauth_offer_pubkey(session, NULL, publickey-&gt;type, pubk
ey);</td><td> </td><td class="right">        rc = ssh_userauth_offer_pubkey(session, NULL, publickey-&gt;type, pubk
ey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l11" /><small>skipping to change at</small><em> line 884</em></th><th> </th><th><a name="part-r11" /><small>skipping to change at</small><em> line 905</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        return SSH_AUTH_SUCCESS;</td><td> </td><td class="right">        return SSH_AUTH_SUCCESS;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } /* if pubkey */</td><td> </td><td class="right">      } /* if pubkey */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(id);</td><td> </td><td class="right">      SAFE_FREE(id);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(privkeyfile);</td><td> </td><td class="right">      SAFE_FREE(privkeyfile);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      publickey_free(publickey);</td><td> </td><td class="right">      publickey_free(publickey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    } /* for each privkey */</td><td> </td><td class="right">    } /* for each privkey */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } /* if agent is running */</td><td> </td><td class="right">  } /* if agent is running */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  size = ARRAY_SIZE(keytab);</td><td> </td><td class="right">  size = ARRAY_SIZE(keytab);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  if (session-&gt;<span class="delete">options-&gt;</span>identity) {</td><td> </td><td class="rblock">  if (session-&gt;identity) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    ssh_log(session, SSH_LOG_RARE,</td><td> </td><td class="right">    ssh_log(session, SSH_LOG_RARE,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        "Trying identity file %s\n", session-&gt;<span class="delete">options-&gt;</span>identity);</td><td> </td><td class="rblock">        "Trying identity file %s\n", session-&gt;identity);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    id = malloc(strlen(session-&gt;<span class="delete">options-&gt;</span>identity) + 1 + 4);</td><td> </td><td class="rblock">    id = malloc(strlen(session-&gt;identity) + 1 + 4);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (id == NULL) {</td><td> </td><td class="right">    if (id == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      leave_function();</td><td> </td><td class="right">      leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return SSH_AUTH_ERROR;</td><td> </td><td class="right">      return SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    sprintf(id, "%s.pub", session-&gt;<span class="delete">options-&gt;</span>identity);</td><td> </td><td class="rblock">    sprintf(id, "%s.pub", session-&gt;identity);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    keytab[size - 1].privatekey = session-&gt;<span class="delete">options-&gt;</span>identity;</td><td> </td><td class="rblock">    keytab[size - 1].privatekey = session-&gt;identity;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    keytab[size - 1].publickey = id;</td><td> </td><td class="right">    keytab[size - 1].publickey = id;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  for (i = 0, pubkey = try_publickey_from_file(session, keytab[i],</td><td> </td><td class="right">  for (i = 0, pubkey = try_publickey_from_file(session, keytab[i],</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        &amp;privkeyfile, &amp;type);</td><td> </td><td class="right">        &amp;privkeyfile, &amp;type);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      i &lt; size;</td><td> </td><td class="right">      i &lt; size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      pubkey = try_publickey_from_file(session, keytab[i++],</td><td> </td><td class="right">      pubkey = try_publickey_from_file(session, keytab[i++],</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        &amp;privkeyfile, &amp;type)) {</td><td> </td><td class="right">        &amp;privkeyfile, &amp;type)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (pubkey == NULL) {</td><td> </td><td class="right">    if (pubkey == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      continue;</td><td> </td><td class="right">      continue;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l12" /><small>skipping to change at</small><em> line 917</em></th><th> </th><th><a name="part-r12" /><small>skipping to change at</small><em> line 938</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    rc = ssh_userauth_offer_pubkey(session, NULL, type, pubkey);</td><td> </td><td class="right">    rc = ssh_userauth_offer_pubkey(session, NULL, type, pubkey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (rc == SSH_AUTH_ERROR){</td><td> </td><td class="right">    if (rc == SSH_AUTH_ERROR){</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      if (id != NULL) {</td><td> </td><td class="right">      if (id != NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        keytab[size - 1].privatekey = NULL;</td><td> </td><td class="right">        keytab[size - 1].privatekey = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        keytab[size - 1].publickey  = NULL;</td><td> </td><td class="right">        keytab[size - 1].publickey  = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        SAFE_FREE(id);</td><td> </td><td class="right">        SAFE_FREE(id);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      }</td><td> </td><td class="right">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      string_free(pubkey);</td><td> </td><td class="right">      string_free(pubkey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(privkeyfile);</td><td> </td><td class="right">      SAFE_FREE(privkeyfile);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      ssh_log(session, SSH_LOG_RARE, "Publickey authentication error");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      leave_function();</td><td> </td><td class="right">      leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return rc;</td><td> </td><td class="right">      return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    } else {</td><td> </td><td class="right">    } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      if (rc != SSH_AUTH_SUCCESS){</td><td> </td><td class="right">      if (rc != SSH_AUTH_SUCCESS){</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        ssh_log(session, SSH_LOG_RARE, "Public<span class="delete"> </span>key refused by server");</td><td> </td><td class="rblock">        ssh_log(session, SSH_LOG_RARE, "Publickey refused by server");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        string_free(pubkey);</td><td> </td><td class="right">        string_free(pubkey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        pubkey = NULL;</td><td> </td><td class="right">        pubkey = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        SAFE_FREE(privkeyfile);</td><td> </td><td class="right">        SAFE_FREE(privkeyfile);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        privkeyfile = NULL;</td><td> </td><td class="right">        privkeyfile = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        continue;</td><td> </td><td class="right">        continue;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      }</td><td> </td><td class="right">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* Public key accepted by server! */</td><td> </td><td class="right">    /* Public key accepted by server! */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    ssh_log(session, SSH_LOG_RARE, "Trying to read privatekey %s", privkeyf
ile);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    privkey = privatekey_from_file(session, privkeyfile, type, passphrase);</td><td> </td><td class="right">    privkey = privatekey_from_file(session, privkeyfile, type, passphrase);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (privkey == NULL) {</td><td> </td><td class="right">    if (privkey == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ssh_log(session, SSH_LOG_FUNCTIONS,</td><td> </td><td class="right">      ssh_log(session, SSH_LOG_FUNCTIONS,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          "Reading private key %s failed (bad passphrase ?)",</td><td> </td><td class="right">          "Reading private key %s failed (bad passphrase ?)",</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          privkeyfile);</td><td> </td><td class="right">          privkeyfile);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      string_free(pubkey);</td><td> </td><td class="right">      string_free(pubkey);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      pubkey = NULL;</td><td> </td><td class="right">      pubkey = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(privkeyfile);</td><td> </td><td class="right">      SAFE_FREE(privkeyfile);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      privkeyfile = NULL;</td><td> </td><td class="right">      privkeyfile = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      continue; /* continue the loop with other pubkey */</td><td> </td><td class="right">      continue; /* continue the loop with other pubkey */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l13" /><small>skipping to change at</small><em> line 997</em></th><th> </th><th><a name="part-r13" /><small>skipping to change at</small><em> line 1020</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (id) {</td><td> </td><td class="right">  if (id) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    keytab[size - 1].privatekey = NULL;</td><td> </td><td class="right">    keytab[size - 1].privatekey = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    keytab[size - 1].publickey  = NULL;</td><td> </td><td class="right">    keytab[size - 1].publickey  = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    SAFE_FREE(id);</td><td> </td><td class="right">    SAFE_FREE(id);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  leave_function();</td><td> </td><td class="right">  leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return SSH_AUTH_DENIED;</td><td> </td><td class="right">  return SSH_AUTH_DENIED;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">static</span> struct ssh_kbdint <span class="delete">*kbdint_new(void)</span> {</td><td> </td><td class="rblock">struct <span class="insert">ssh_kbdint_struct {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">struct</span> ssh_kbdint <span class="delete">*kbd;</span></td><td> </td><td class="rblock"><span class="insert">    uint32_t nprompts;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    char *name;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    char *instruction;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    char **prompts;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    unsigned char *echo; /* bool array */</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    char **answers;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">};</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static</span> ssh_kbdint <span class="insert">kbdint_new(void)</span> {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">  ssh_kbdint <span class="insert">kbd;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  kbd = malloc(sizeof (struct ssh_kbdint));</td><td> </td><td class="rblock">  kbd = malloc(sizeof (struct ssh_kbdint<span class="insert">_struct</span>));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (kbd == NULL) {</td><td> </td><td class="right">  if (kbd == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return NULL;</td><td> </td><td class="right">    return NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  ZERO_STRUCTP(kbd);</td><td> </td><td class="right">  ZERO_STRUCTP(kbd);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return kbd;</td><td> </td><td class="right">  return kbd;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static void kbdint_free(s<span class="delete">truct ssh_kbdint *</span>kbd) {</td><td> </td><td class="rblock">static void kbdint_free(s<span class="insert">sh_kbdint </span>kbd) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int i, n;</td><td> </td><td class="right">  int i, n;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (kbd == NULL) {</td><td> </td><td class="right">  if (kbd == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return;</td><td> </td><td class="right">    return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  n = kbd-&gt;nprompts;</td><td> </td><td class="right">  n = kbd-&gt;nprompts;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  SAFE_FREE(kbd-&gt;name);</td><td> </td><td class="right">  SAFE_FREE(kbd-&gt;name);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  SAFE_FREE(kbd-&gt;instruction);</td><td> </td><td class="right">  SAFE_FREE(kbd-&gt;instruction);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l14" /><small>skipping to change at</small><em> line 1040</em></th><th> </th><th><a name="part-r14" /><small>skipping to change at</small><em> line 1072</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    for (i = 0; i &lt; n; i++) {</td><td> </td><td class="right">    for (i = 0; i &lt; n; i++) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      BURN_STRING(kbd-&gt;answers[i]);</td><td> </td><td class="right">      BURN_STRING(kbd-&gt;answers[i]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(kbd-&gt;answers[i]);</td><td> </td><td class="right">      SAFE_FREE(kbd-&gt;answers[i]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    SAFE_FREE(kbd-&gt;answers);</td><td> </td><td class="right">    SAFE_FREE(kbd-&gt;answers);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  SAFE_FREE(kbd);</td><td> </td><td class="right">  SAFE_FREE(kbd);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static void kbdint_clean(s<span class="delete">truct ssh_kbdint *</span>kbd) {</td><td> </td><td class="rblock">static void kbdint_clean(s<span class="insert">sh_kbdint </span>kbd) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int i, n;</td><td> </td><td class="right">  int i, n;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (kbd == NULL) {</td><td> </td><td class="right">  if (kbd == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return;</td><td> </td><td class="right">    return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  n = kbd-&gt;nprompts;</td><td> </td><td class="right">  n = kbd-&gt;nprompts;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  SAFE_FREE(kbd-&gt;name);</td><td> </td><td class="right">  SAFE_FREE(kbd-&gt;name);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  SAFE_FREE(kbd-&gt;instruction);</td><td> </td><td class="right">  SAFE_FREE(kbd-&gt;instruction);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l15" /><small>skipping to change at</small><em> line 1074</em></th><th> </th><th><a name="part-r15" /><small>skipping to change at</small><em> line 1106</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(kbd-&gt;answers[i]);</td><td> </td><td class="right">      SAFE_FREE(kbd-&gt;answers[i]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SAFE_FREE(kbd-&gt;answers);</td><td> </td><td class="right">      SAFE_FREE(kbd-&gt;answers);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  kbd-&gt;nprompts = 0;</td><td> </td><td class="right">  kbd-&gt;nprompts = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/* this function sends the first packet as explained in section 3.1</td><td> </td><td class="right">/* this function sends the first packet as explained in section 3.1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * of the draft */</td><td> </td><td class="right"> * of the draft */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static int kbdauth_init(<span class="delete">SSH_SESSION *</span>session, const char *user,</td><td> </td><td class="rblock">static int kbdauth_init(<span class="insert">ssh_session </span>session, const char *user,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    const char *submethods) {</td><td> </td><td class="right">    const char *submethods) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *usr</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string usr</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *sub</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string sub</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *service</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string service</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *method</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string method</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  usr = string_from_char(user);</td><td> </td><td class="right">  usr = string_from_char(user);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (usr == NULL) {</td><td> </td><td class="right">  if (usr == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    goto error;</td><td> </td><td class="right">    goto error;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  sub = (submethods ? string_from_char(submethods) : string_from_char(""));</td><td> </td><td class="right">  sub = (submethods ? string_from_char(submethods) : string_from_char(""));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (sub == NULL) {</td><td> </td><td class="right">  if (sub == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l16" /><small>skipping to change at</small><em> line 1134</em></th><th> </th><th><a name="part-r16" /><small>skipping to change at</small><em> line 1166</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  buffer_reinit(session-&gt;out_buffer);</td><td> </td><td class="right">  buffer_reinit(session-&gt;out_buffer);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_free(usr);</td><td> </td><td class="right">  string_free(usr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_free(service);</td><td> </td><td class="right">  string_free(service);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_free(method);</td><td> </td><td class="right">  string_free(method);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  string_free(sub);</td><td> </td><td class="right">  string_free(sub);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  leave_function();</td><td> </td><td class="right">  leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return rc;</td><td> </td><td class="right">  return rc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static int <span class="delete">kbdauth_info_get(SSH_SESSION *session)</span> {</td><td> </td><td class="rblock">static int <span class="insert">kbdauth_info_get(ssh_session session)</span> {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *name;</span> /* name of the "asking" window showed to client */</td><td> </td><td class="rblock">  <span class="insert">ssh_string name;</span> /* name of the "asking" window showed to client */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *instruction;</span></td><td> </td><td class="rblock">  <span class="insert">ssh_string instruction;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">  STRING *tmp;</span></td><td> </td><td class="rblock"><span class="insert">  ssh_string tmp;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">  u32</span> nprompts;</td><td> </td><td class="rblock"><span class="insert">  uint32_t</span> nprompts;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">u32</span> i;</td><td> </td><td class="rblock">  <span class="insert">uint32_t</span> i;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  name = buffer_get_ssh_string(session-&gt;in_buffer);</td><td> </td><td class="right">  name = buffer_get_ssh_string(session-&gt;in_buffer);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  instruction = buffer_get_ssh_string(session-&gt;in_buffer);</td><td> </td><td class="right">  instruction = buffer_get_ssh_string(session-&gt;in_buffer);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  tmp = buffer_get_ssh_string(session-&gt;in_buffer);</td><td> </td><td class="right">  tmp = buffer_get_ssh_string(session-&gt;in_buffer);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  buffer_get_u32(session-&gt;in_buffer, &amp;nprompts);</td><td> </td><td class="right">  buffer_get_u32(session-&gt;in_buffer, &amp;nprompts);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (name == NULL || instruction == NULL || tmp == NULL) {</td><td> </td><td class="right">  if (name == NULL || instruction == NULL || tmp == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    string_free(name);</td><td> </td><td class="right">    string_free(name);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l17" /><small>skipping to change at</small><em> line 1251</em></th><th> </th><th><a name="part-r17" /><small>skipping to change at</small><em> line 1283</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      leave_function();</td><td> </td><td class="right">      leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return SSH_AUTH_ERROR;</td><td> </td><td class="right">      return SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  leave_function();</td><td> </td><td class="right">  leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return SSH_AUTH_INFO; /* we are not auth. but we parsed the packet */</td><td> </td><td class="right">  return SSH_AUTH_INFO; /* we are not auth. but we parsed the packet */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/* sends challenge back to the server */</td><td> </td><td class="right">/* sends challenge back to the server */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static int <span class="delete">kbdauth_send(SSH_SESSION *session)</span> {</td><td> </td><td class="rblock">static int <span class="insert">kbdauth_send(ssh_session session)</span> {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">STRING *answer</span> = NULL;</td><td> </td><td class="rblock">  <span class="insert">ssh_string answer</span> = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  u<span class="delete">32</span> i;</td><td> </td><td class="rblock">  u<span class="insert">int32_t</span> i;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (buffer_add_u8(session-&gt;out_buffer, SSH2_MSG_USERAUTH_INFO_RESPONSE) &lt;
 0 ||</td><td> </td><td class="right">  if (buffer_add_u8(session-&gt;out_buffer, SSH2_MSG_USERAUTH_INFO_RESPONSE) &lt;
 0 ||</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      buffer_add_u32(session-&gt;out_buffer,</td><td> </td><td class="right">      buffer_add_u32(session-&gt;out_buffer,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        htonl(session-&gt;kbdint-&gt;nprompts)) &lt; 0) {</td><td> </td><td class="right">        htonl(session-&gt;kbdint-&gt;nprompts)) &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    goto error;</td><td> </td><td class="right">    goto error;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  for (i = 0; i &lt; session-&gt;kbdint-&gt;nprompts; i++) {</td><td> </td><td class="right">  for (i = 0; i &lt; session-&gt;kbdint-&gt;nprompts; i++) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l18" /><small>skipping to change at</small><em> line 1324</em></th><th> </th><th><a name="part-r18" /><small>skipping to change at</small><em> line 1356</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_SUCCESS: Authentication success\n</td><td> </td><td class="right"> *          SSH_AUTH_SUCCESS: Authentication success\n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *          SSH_AUTH_INFO:    The server asked some questions. Use</td><td> </td><td class="right"> *          SSH_AUTH_INFO:    The server asked some questions. Use</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                            ssh_userauth_kbdint_getnprompts() and such.</td><td> </td><td class="right"> *                            ssh_userauth_kbdint_getnprompts() and such.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_kbdint_getnprompts()</td><td> </td><td class="right"> * @see ssh_userauth_kbdint_getnprompts()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_kbdint_getname()</td><td> </td><td class="right"> * @see ssh_userauth_kbdint_getname()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_kbdint_getinstruction()</td><td> </td><td class="right"> * @see ssh_userauth_kbdint_getinstruction()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_kbdint_getprompt()</td><td> </td><td class="right"> * @see ssh_userauth_kbdint_getprompt()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @see ssh_userauth_kbdint_setanswer()</td><td> </td><td class="right"> * @see ssh_userauth_kbdint_setanswer()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int ssh_userauth_kbdint(<span class="delete">SSH_SESSION *</span>session, const char *user,</td><td> </td><td class="rblock">int ssh_userauth_kbdint(<span class="insert">ssh_session </span>session, const char *user,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    const char *submethods) {</td><td> </td><td class="right">    const char *submethods) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int rc = SSH_AUTH_ERROR;</td><td> </td><td class="right">  int rc = SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;version == 1) {</td><td> </td><td class="right">  if (session-&gt;version == 1) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* No keyb-interactive for ssh1 */</td><td> </td><td class="right">    /* No keyb-interactive for ssh1 */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return SSH_AUTH_DENIED;</td><td> </td><td class="right">    return SSH_AUTH_DENIED;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  enter_function();</td><td> </td><td class="right">  enter_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;kbdint == NULL) {</td><td> </td><td class="right">  if (session-&gt;kbdint == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* first time we call. we must ask for a challenge */</td><td> </td><td class="right">    /* first time we call. we must ask for a challenge */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (user == NULL) {</td><td> </td><td class="right">    if (user == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if ((user = <span class="delete">session-&gt;options-&gt;username)</span> == NULL) {</td><td> </td><td class="rblock">      if ((user = <span class="insert">session-&gt;username)</span> == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if <span class="delete">(ssh_options_default_username(session-&gt;options)</span> &lt; 0) {</td><td> </td><td class="rblock">        if <span class="insert">(ssh_options_set(session, SSH_OPTIONS_USER, NULL)</span> &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          leave_function();</td><td> </td><td class="right">          leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          return SSH_AUTH_ERROR;</td><td> </td><td class="right">          return SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        } else {</td><td> </td><td class="right">        } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          user = session-&gt;<span class="delete">options-&gt;</span>username;</td><td> </td><td class="rblock">          user = session-&gt;username;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        }</td><td> </td><td class="right">        }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      }</td><td> </td><td class="right">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (ask_userauth(session)) {</td><td> </td><td class="right">    if (ask_userauth(session)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      leave_function();</td><td> </td><td class="right">      leave_function();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return SSH_AUTH_ERROR;</td><td> </td><td class="right">      return SSH_AUTH_ERROR;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    rc = kbdauth_init(session, user, submethods);</td><td> </td><td class="right">    rc = kbdauth_init(session, user, submethods);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l19" /><small>skipping to change at</small><em> line 1404</em></th><th> </th><th><a name="part-r19" /><small>skipping to change at</small><em> line 1436</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/**</td><td> </td><td class="right">/**</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @brief Get the number of prompts (questions) the server has given.</td><td> </td><td class="right"> * @brief Get the number of prompts (questions) the server has given.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. This</td><td> </td><td class="right"> * You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * function returns the questions from the server.</td><td> </td><td class="right"> * function returns the questions from the server.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param session       The ssh session to use.</td><td> </td><td class="right"> * @param session       The ssh session to use.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @returns             The number of prompts.</td><td> </td><td class="right"> * @returns             The number of prompts.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int ssh_userauth_kbdint_getnprompts(<span class="delete">SSH_SESSION *</span>session) {</td><td> </td><td class="rblock">int ssh_userauth_kbdint_getnprompts(<span class="insert">ssh_session </span>session) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return session-&gt;kbdint-&gt;nprompts;</td><td> </td><td class="right">  return session-&gt;kbdint-&gt;nprompts;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/**</td><td> </td><td class="right">/**</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @brief Get the "name" of the message block.</td><td> </td><td class="right"> * @brief Get the "name" of the message block.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. This</td><td> </td><td class="right"> * You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * function returns the questions from the server.</td><td> </td><td class="right"> * function returns the questions from the server.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param session       The ssh session to use.</td><td> </td><td class="right"> * @param session       The ssh session to use.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @returns             The name of the message block. Do not free it.</td><td> </td><td class="right"> * @returns             The name of the message block. Do not free it.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">const char *ssh_userauth_kbdint_getname(<span class="delete">SSH_SESSION *</span>session) {</td><td> </td><td class="rblock">const char *ssh_userauth_kbdint_getname(<span class="insert">ssh_session </span>session) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return session-&gt;kbdint-&gt;name;</td><td> </td><td class="right">  return session-&gt;kbdint-&gt;name;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/**</td><td> </td><td class="right">/**</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @brief Get the "instruction" of the message block.</td><td> </td><td class="right"> * @brief Get the "instruction" of the message block.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. This</td><td> </td><td class="right"> * You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * function returns the questions from the server.</td><td> </td><td class="right"> * function returns the questions from the server.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param session       The ssh session to use.</td><td> </td><td class="right"> * @param session       The ssh session to use.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @returns             The instruction of the message block.</td><td> </td><td class="right"> * @returns             The instruction of the message block.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">const char *ssh_userauth_kbdint_getinstruction(<span class="delete">SSH_SESSION *</span>session) {</td><td> </td><td class="rblock">const char *ssh_userauth_kbdint_getinstruction(<span class="insert">ssh_session </span>session) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return session-&gt;kbdint-&gt;instruction;</td><td> </td><td class="right">  return session-&gt;kbdint-&gt;instruction;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/**</td><td> </td><td class="right">/**</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @brief Get a prompt from a message block.</td><td> </td><td class="right"> * @brief Get a prompt from a message block.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. This</td><td> </td><td class="right"> * You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * function returns the questions from the server.</td><td> </td><td class="right"> * function returns the questions from the server.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param session       The ssh session to use.</td><td> </td><td class="right"> * @param session       The ssh session to use.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param i             The inndex number of the i'th prompt.</td><td> </td><td class="right"> * @param i             The inndex number of the i'th prompt.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param echo          When different of NULL, it will obtain a boolean me
aning</td><td> </td><td class="right"> * @param echo          When different of NULL, it will obtain a boolean me
aning</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                      that the resulting user input should be echoed or n
ot</td><td> </td><td class="right"> *                      that the resulting user input should be echoed or n
ot</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *                      (like passwords).</td><td> </td><td class="right"> *                      (like passwords).</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @returns             A pointer to the prompt. Do not free it.</td><td> </td><td class="right"> * @returns             A pointer to the prompt. Do not free it.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">const char *ssh_userauth_kbdint_getprompt(<span class="delete">SSH_SESSION *session, unsigned in
t</span> i,</td><td> </td><td class="rblock">const char *ssh_userauth_kbdint_getprompt(<span class="insert">ssh_session session, unsigned int
</span> i,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    char *echo) {</td><td> </td><td class="right">    char *echo) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (i &gt; session-&gt;kbdint-&gt;nprompts) {</td><td> </td><td class="right">  if (i &gt; session-&gt;kbdint-&gt;nprompts) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return NULL;</td><td> </td><td class="right">    return NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (echo) {</td><td> </td><td class="right">  if (echo) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    *echo = session-&gt;kbdint-&gt;echo[i];</td><td> </td><td class="right">    *echo = session-&gt;kbdint-&gt;echo[i];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return session-&gt;kbdint-&gt;prompts[i];</td><td> </td><td class="right">  return session-&gt;kbdint-&gt;prompts[i];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/** You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. this</td><td> </td><td class="right">/** You have called ssh_userauth_kbdint() and got SSH_AUTH_INFO. this</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * function returns the questions from the server</td><td> </td><td class="right"> * function returns the questions from the server</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * \brief set the answer for a question from a message block.</td><td> </td><td class="right"> * \brief set the answer for a question from a message block.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * \param session ssh session</td><td> </td><td class="right"> * \param session ssh session</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * \param i index number of the ith prompt</td><td> </td><td class="right"> * \param i index number of the ith prompt</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * \param answer answer to give to server</td><td> </td><td class="right"> * \param answer answer to give to server</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * \return 0 on success, &lt; 0 on error.</td><td> </td><td class="right"> * \return 0 on success, &lt; 0 on error.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0057" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">int ssh_userauth_kbdint_setanswer(<span class="delete">SSH_SESSION *</span>session, unsigned int i,</td><td> </td><td class="rblock">int ssh_userauth_kbdint_setanswer(<span class="insert">ssh_session </span>session, unsigned int i,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    const char *answer) {</td><td> </td><td class="right">    const char *answer) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session == NULL || answer == NULL || i &gt; session-&gt;kbdint-&gt;nprompts) {</td><td> </td><td class="right">  if (session == NULL || answer == NULL || i &gt; session-&gt;kbdint-&gt;nprompts) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    return -1;</td><td> </td><td class="right">    return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (session-&gt;kbdint-&gt;answers == NULL) {</td><td> </td><td class="right">  if (session-&gt;kbdint-&gt;answers == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    session-&gt;kbdint-&gt;answers = malloc(sizeof(char*) * session-&gt;kbdint-&gt;npro
mpts);</td><td> </td><td class="right">    session-&gt;kbdint-&gt;answers = malloc(sizeof(char*) * session-&gt;kbdint-&gt;npro
mpts);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (session-&gt;kbdint-&gt;answers == NULL) {</td><td> </td><td class="right">    if (session-&gt;kbdint-&gt;answers == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      return -1;</td><td> </td><td class="right">      return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 57 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>102 lines changed or deleted</i></th><th><i> </i></th><th><i>134 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
