<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux aponomarenko 3.2.0-29-generic #46-Ubuntu SMP Fri Jul 27 17:03:23 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 3.1.8 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.2 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 0.6.5 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: check_ipc.c - check_ipc.c</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;check_ipc.c&nbsp;</th><th> </th><th>&nbsp;check_ipc.c&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 27</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 27</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td> </td><td class="right"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * GNU Lesser General Public License for more details.</td><td> </td><td class="right"> * GNU Lesser General Public License for more details.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You should have received a copy of the GNU Lesser General Public License</td><td> </td><td class="right"> * You should have received a copy of the GNU Lesser General Public License</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * along with libqb.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</td><td> </td><td class="right"> * along with libqb.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;stdio.h&gt;</td><td> </td><td class="right">#include &lt;stdio.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;stdlib.h&gt;</td><td> </td><td class="right">#include &lt;stdlib.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;unistd.h&gt;</td><td> </td><td class="right">#include &lt;unistd.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include &lt;syslog.h&gt;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;sys/types.h&gt;</td><td> </td><td class="right">#include &lt;sys/types.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;sys/wait.h&gt;</td><td> </td><td class="right">#include &lt;sys/wait.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;errno.h&gt;</td><td> </td><td class="right">#include &lt;errno.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;signal.h&gt;</td><td> </td><td class="right">#include &lt;signal.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;check.h&gt;</td><td> </td><td class="right">#include &lt;check.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;qb/qbdefs.h&gt;</td><td> </td><td class="right">#include &lt;qb/qbdefs.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#include &lt;qb/qb<span class="delete">util</span>.h&gt;</td><td> </td><td class="rblock">#include &lt;qb/qb<span class="insert">log</span>.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;qb/qbipcc.h&gt;</td><td> </td><td class="right">#include &lt;qb/qbipcc.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;qb/qbipcs.h&gt;</td><td> </td><td class="right">#include &lt;qb/qbipcs.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;qb/qbloop.h&gt;</td><td> </td><td class="right">#include &lt;qb/qbloop.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#define IPC_NAME "ipc_test"</span></td><td> </td><td class="rblock"><span class="insert">static const char *ipc_name = "ipc_test";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define MAX_MSG_SIZE (8192*16)</td><td> </td><td class="right">#define MAX_MSG_SIZE (8192*16)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static qb_ipcc_connection_t *conn;</td><td> </td><td class="right">static qb_ipcc_connection_t *conn;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static enum qb_ipc_type ipc_type;</td><td> </td><td class="right">static enum qb_ipc_type ipc_type;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">enum my_msg_ids {</td><td> </td><td class="right">enum my_msg_ids {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       IPC_MSG_REQ_TX_RX,</td><td> </td><td class="right">       IPC_MSG_REQ_TX_RX,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       IPC_MSG_RES_TX_RX,</td><td> </td><td class="right">       IPC_MSG_RES_TX_RX,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       IPC_MSG_REQ_DISPATCH,</td><td> </td><td class="right">       IPC_MSG_REQ_DISPATCH,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       IPC_MSG_RES_DISPATCH,</td><td> </td><td class="right">       IPC_MSG_RES_DISPATCH,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       IPC_MSG_REQ_SERVER_FAIL,</td><td> </td><td class="right">       IPC_MSG_REQ_SERVER_FAIL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 79</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 78</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * 8) multiple services</td><td> </td><td class="right"> * 8) multiple services</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static qb_loop_t *my_loop;</td><td> </td><td class="right">static qb_loop_t *my_loop;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static qb_ipcs_service_t* s1;</td><td> </td><td class="right">static qb_ipcs_service_t* s1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t turn_on_fc = QB_FALSE;</td><td> </td><td class="right">static int32_t turn_on_fc = QB_FALSE;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t fc_enabled = 89;</td><td> </td><td class="right">static int32_t fc_enabled = 89;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t exit_handler(int32_t rsignal, void *data)</td><td> </td><td class="right">static int32_t exit_handler(int32_t rsignal, void *data)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       qb_log(LOG_DEBUG, "caught signal %d", rsignal);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_ipcs_destroy(s1);</td><td> </td><td class="right">       qb_ipcs_destroy(s1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">qb_loop_stop(my_loop);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       exit(0);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return -1;</td><td> </td><td class="right">       return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t s1_msg_process_fn(qb_ipcs_connection_t *c,</td><td> </td><td class="right">static int32_t s1_msg_process_fn(qb_ipcs_connection_t *c,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               void *data, size_t size)</td><td> </td><td class="right">               void *data, size_t size)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       struct qb_ipc_request_header *req_pt = (struct qb_ipc_request_header
 *)data;</td><td> </td><td class="right">       struct qb_ipc_request_header *req_pt = (struct qb_ipc_request_header
 *)data;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       struct qb_ipc_response_header response;</td><td> </td><td class="right">       struct qb_ipc_response_header response;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ssize_t res;</td><td> </td><td class="right">       ssize_t res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (req_pt-&gt;id == IPC_MSG_REQ_TX_RX) {</td><td> </td><td class="right">       if (req_pt-&gt;id == IPC_MSG_REQ_TX_RX) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               response.size = sizeof(struct qb_ipc_response_header);</td><td> </td><td class="right">               response.size = sizeof(struct qb_ipc_response_header);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               response.id = IPC_MSG_RES_TX_RX;</td><td> </td><td class="right">               response.id = IPC_MSG_RES_TX_RX;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               response.error = 0;</td><td> </td><td class="right">               response.error = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               res = qb_ipcs_response_send(c, &amp;response,</td><td> </td><td class="rblock">               res = qb_ipcs_response_send(c, &amp;response, <span class="insert">response.size);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">sizeof(response));</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (res &lt; 0) {</td><td> </td><td class="right">               if (res &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">perror("qb_ipcs_response_send");</span></td><td> </td><td class="rblock">                       <span class="insert">qb_perror(LOG_INFO, "qb_ipcs_response_send");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               } else if (res != response.size) {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       qb_log(LOG_DEBUG, "qb_ipcs_response_send %zd != %d",</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                              res, response.size);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (turn_on_fc) {</td><td> </td><td class="right">               if (turn_on_fc) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       qb_ipcs_request_rate_limit(s1, QB_IPCS_RATE_OFF);</td><td> </td><td class="right">                       qb_ipcs_request_rate_limit(s1, QB_IPCS_RATE_OFF);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       } else if (req_pt-&gt;id == IPC_MSG_REQ_DISPATCH) {</td><td> </td><td class="right">       } else if (req_pt-&gt;id == IPC_MSG_REQ_DISPATCH) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               response.size = sizeof(struct qb_ipc_response_header);</td><td> </td><td class="right">               response.size = sizeof(struct qb_ipc_response_header);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               response.id = IPC_MSG_RES_DISPATCH;</td><td> </td><td class="right">               response.id = IPC_MSG_RES_DISPATCH;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               response.error = 0;</td><td> </td><td class="right">               response.error = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               res = qb_ipcs_event_send(c, &amp;response,</td><td> </td><td class="right">               res = qb_ipcs_event_send(c, &amp;response,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               sizeof(response));</td><td> </td><td class="right">                               sizeof(response));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (res &lt; 0) {</td><td> </td><td class="right">               if (res &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">perror(</span>"qb_ipcs_event_send");</td><td> </td><td class="rblock">                       <span class="insert">qb_perror(LOG_INFO, </span>"qb_ipcs_event_send");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       } else if (req_pt-&gt;id == IPC_MSG_REQ_SERVER_FAIL) {</td><td> </td><td class="right">       } else if (req_pt-&gt;id == IPC_MSG_REQ_SERVER_FAIL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qb_ipcs_destroy(s1);</td><td> </td><td class="right">               qb_ipcs_destroy(s1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               exit(0);</td><td> </td><td class="right">               exit(0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return 0;</td><td> </td><td class="right">       return 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static <span class="delete">void ipc_log_fn(const char *file_name,</span></td><td> </td><td class="rblock">static int32_t <span class="insert">my_job_add(enum qb_loop_priority p,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                      int32_t file_line,</span> int32_t <span class="delete">severity, const char *msg)</span></td><td> </td><td class="rblock"><span class="insert">                         void *data,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                         qb_loop_job_dispatch_fn fn)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">if (severity &lt; LOG_INFO)</span></td><td> </td><td class="rblock">       <span class="insert">return qb_loop_job_add(my_loop, p, data, fn);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               fprintf(stderr, "%s:%d [%d] %s\n", file_name, file_line, sev</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">erity, msg);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t my_dispatch_add(enum qb_loop_priority p, int32_t fd, int32_t
 events,</td><td> </td><td class="right">static int32_t my_dispatch_add(enum qb_loop_priority p, int32_t fd, int32_t
 events,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       void *data, qb_ipcs_dispatch_fn_t fn)</td><td> </td><td class="right">       void *data, qb_ipcs_dispatch_fn_t fn)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return qb_loop_poll_add(my_loop, p, fd, events, data, fn);</td><td> </td><td class="right">       return qb_loop_poll_add(my_loop, p, fd, events, data, fn);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t my_dispatch_mod(enum qb_loop_priority p, int32_t fd, int32_t
 events,</td><td> </td><td class="right">static int32_t my_dispatch_mod(enum qb_loop_priority p, int32_t fd, int32_t
 events,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       void *data, qb_ipcs_dispatch_fn_t fn)</td><td> </td><td class="right">       void *data, qb_ipcs_dispatch_fn_t fn)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return qb_loop_poll_mod(my_loop, p, fd, events, data, fn);</td><td> </td><td class="right">       return qb_loop_poll_mod(my_loop, p, fd, events, data, fn);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t my_dispatch_del(int32_t fd)</td><td> </td><td class="right">static int32_t my_dispatch_del(int32_t fd)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return qb_loop_poll_del(my_loop, fd);</td><td> </td><td class="right">       return qb_loop_poll_del(my_loop, fd);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static void s1_connection_destroyed(qb_ipcs_connection_t *c)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">{</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       qb_enter();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       qb_loop_stop(my_loop);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void run_ipc_server(void)</td><td> </td><td class="right">static void run_ipc_server(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t res;</td><td> </td><td class="right">       int32_t res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_loop_signal_handle handle;</td><td> </td><td class="right">       qb_loop_signal_handle handle;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       struct qb_ipcs_service_handlers sh = {</td><td> </td><td class="right">       struct qb_ipcs_service_handlers sh = {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               .connection_accept = NULL,</td><td> </td><td class="right">               .connection_accept = NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               .connection_created = NULL,</td><td> </td><td class="right">               .connection_created = NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               .msg_process = s1_msg_process_fn,</td><td> </td><td class="right">               .msg_process = s1_msg_process_fn,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               .connection_destroyed = <span class="delete">NULL</span>,</td><td> </td><td class="rblock">               .connection_destroyed = <span class="insert">s1_connection_destroyed</span>,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               .connection_closed = NULL,</td><td> </td><td class="right">               .connection_closed = NULL,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       };</td><td> </td><td class="right">       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       struct qb_ipcs_poll_handlers ph = {</td><td> </td><td class="right">       struct qb_ipcs_poll_handlers ph = {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               .job_add = my_job_add,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               .dispatch_add = my_dispatch_add,</td><td> </td><td class="right">               .dispatch_add = my_dispatch_add,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               .dispatch_mod = my_dispatch_mod,</td><td> </td><td class="right">               .dispatch_mod = my_dispatch_mod,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               .dispatch_del = my_dispatch_del,</td><td> </td><td class="right">               .dispatch_del = my_dispatch_del,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       };</td><td> </td><td class="right">       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_loop_signal_add(my_loop, QB_LOOP_HIGH, SIGSTOP,</td><td> </td><td class="right">       qb_loop_signal_add(my_loop, QB_LOOP_HIGH, SIGSTOP,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          NULL, exit_handler, &amp;handle);</td><td> </td><td class="right">                          NULL, exit_handler, &amp;handle);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_loop_signal_add(my_loop, QB_LOOP_HIGH, SIGTERM,</td><td> </td><td class="right">       qb_loop_signal_add(my_loop, QB_LOOP_HIGH, SIGTERM,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          NULL, exit_handler, &amp;handle);</td><td> </td><td class="right">                          NULL, exit_handler, &amp;handle);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       my_loop = qb_loop_create();</td><td> </td><td class="right">       my_loop = qb_loop_create();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       s1 = qb_ipcs_create(<span class="delete">IPC_NAME</span>, 4, ipc_type, &amp;sh);</td><td> </td><td class="rblock">       s1 = qb_ipcs_create(<span class="insert">ipc_name</span>, 4, ipc_type, &amp;sh);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       fail_if(s1 == 0);</td><td> </td><td class="right">       fail_if(s1 == 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_ipcs_poll_handlers_set(s1, &amp;ph);</td><td> </td><td class="right">       qb_ipcs_poll_handlers_set(s1, &amp;ph);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       res = qb_ipcs_run(s1);</td><td> </td><td class="right">       res = qb_ipcs_run(s1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ck_assert_int_eq(res, 0);</td><td> </td><td class="right">       ck_assert_int_eq(res, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_loop_run(my_loop);</td><td> </td><td class="right">       qb_loop_run(my_loop);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 199</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 206</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (pid == 0) {</td><td> </td><td class="right">       if (pid == 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               run_ipc_server_fn();</td><td> </td><td class="right">               run_ipc_server_fn();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return 0;</td><td> </td><td class="right">               return 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return pid;</td><td> </td><td class="right">       return pid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t stop_process(pid_t pid)</td><td> </td><td class="right">static int32_t stop_process(pid_t pid)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">/* wait a bit for the server to shutdown by it's self */</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       usleep(100000);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       kill(pid, SIGTERM);</td><td> </td><td class="right">       kill(pid, SIGTERM);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       waitpid(pid, NULL, 0);</td><td> </td><td class="right">       waitpid(pid, NULL, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return 0;</td><td> </td><td class="right">       return 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#define IPC_BUF_SIZE (1024</span> * <span class="delete">1024)</span></td><td> </td><td class="rblock"><span class="insert">struct my_req {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static <span class="delete">char buffer[IPC_BUF_SIZE];</span></td><td> </td><td class="rblock"><span class="insert">       struct qb_ipc_request_header hdr;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       char message[1024</span> * <span class="insert">1024];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">};</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">static <span class="insert">struct my_req request;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t send_and_check(uint32_t size, int32_t ms_timeout)</td><td> </td><td class="right">static int32_t send_and_check(uint32_t size, int32_t ms_timeout)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       struct qb_ipc_request_header *req_header = (struct qb_ipc_request_he
ader *)buffer;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       struct qb_ipc_response_header res_header;</td><td> </td><td class="right">       struct qb_ipc_response_header res_header;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t res;</td><td> </td><td class="right">       int32_t res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t try_times = 0;</td><td> </td><td class="right">       int32_t try_times = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">req_header-&gt;id</span> = IPC_MSG_REQ_TX_RX;</td><td> </td><td class="rblock">       <span class="insert">request.hdr.id</span> = IPC_MSG_REQ_TX_RX;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">req_header-&gt;size</span> = sizeof(struct qb_ipc_request_header) + size;</td><td> </td><td class="rblock">       <span class="insert">request.hdr.size</span> = sizeof(struct qb_ipc_request_header) + size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">repeat_send:</td><td> </td><td class="right">repeat_send:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       res = qb_ipcc_send(conn, <span class="delete">req_header, req_header-&gt;</span>size);</td><td> </td><td class="rblock">       res = qb_ipcc_send(conn, <span class="insert">&amp;request, request.hdr.</span>size);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       try_times++;</td><td> </td><td class="right">       try_times++;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (res &lt; 0) {</td><td> </td><td class="right">       if (res &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (res == -EAGAIN &amp;&amp; try_times &lt; 10) {</td><td> </td><td class="right">               if (res == -EAGAIN &amp;&amp; try_times &lt; 10) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       goto repeat_send;</td><td> </td><td class="right">                       goto repeat_send;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               } else {</td><td> </td><td class="right">               } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (res == -EAGAIN &amp;&amp; try_times &gt;= 10) {</td><td> </td><td class="right">                       if (res == -EAGAIN &amp;&amp; try_times &gt;= 10) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               fc_enabled = QB_TRUE;</td><td> </td><td class="right">                               fc_enabled = QB_TRUE;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       errno = -res;</td><td> </td><td class="right">                       errno = -res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">perror(</span>"qb_ipcc_send");</td><td> </td><td class="rblock">                       <span class="insert">qb_perror(LOG_INFO, </span>"qb_ipcc_send");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       return res;</td><td> </td><td class="right">                       return res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       try_times = 0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> repeat_recv:</td><td> </td><td class="right"> repeat_recv:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       res = qb_ipcc_recv(conn, &amp;res_header,</td><td> </td><td class="right">       res = qb_ipcc_recv(conn, &amp;res_header,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sizeof(struct qb_ipc_response_header), ms_timeout);</td><td> </td><td class="right">                       sizeof(struct qb_ipc_response_header), ms_timeout);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       try_times++;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (res == -EINTR) {</td><td> </td><td class="right">       if (res == -EINTR) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return -1;</td><td> </td><td class="right">               return -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (res == -EAGAIN || res == -ETIMEDOUT) {</td><td> </td><td class="right">       if (res == -EAGAIN || res == -ETIMEDOUT) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               goto repeat_recv;</td><td> </td><td class="rblock">               <span class="insert">if (try_times &lt; 10) {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       goto repeat_recv;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">} else {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       fc_enabled = QB_TRUE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       qb_perror(LOG_DEBUG, "qb_ipcc_recv");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return res;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ck_assert_int_eq(res, sizeof(struct qb_ipc_response_header));</td><td> </td><td class="right">       ck_assert_int_eq(res, sizeof(struct qb_ipc_response_header));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ck_assert_int_eq(res_header.id, IPC_MSG_RES_TX_RX);</td><td> </td><td class="right">       ck_assert_int_eq(res_header.id, IPC_MSG_RES_TX_RX);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ck_assert_int_eq(res_header.size, sizeof(struct qb_ipc_response_head
er));</td><td> </td><td class="right">       ck_assert_int_eq(res_header.size, sizeof(struct qb_ipc_response_head
er));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return 0;</td><td> </td><td class="right">       return 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static int32_t recv_timeout = -1;</td><td> </td><td class="right">static int32_t recv_timeout = -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void test_ipc_txrx(void)</td><td> </td><td class="right">static void test_ipc_txrx(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t j;</td><td> </td><td class="right">       int32_t j;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t c = 0;</td><td> </td><td class="right">       int32_t c = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       size_t size;</td><td> </td><td class="right">       size_t size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       pid_t pid;</td><td> </td><td class="right">       pid_t pid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       pid = run_function_in_new_process(run_ipc_server);</td><td> </td><td class="right">       pid = run_function_in_new_process(run_ipc_server);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       fail_if(pid == -1);</td><td> </td><td class="right">       fail_if(pid == -1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sleep(1);</td><td> </td><td class="right">       sleep(1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       do {</td><td> </td><td class="right">       do {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               conn = qb_ipcc_connect(<span class="delete">IPC_NAME</span>, MAX_MSG_SIZE);</td><td> </td><td class="rblock">               conn = qb_ipcc_connect(<span class="insert">ipc_name</span>, MAX_MSG_SIZE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (conn == NULL) {</td><td> </td><td class="right">               if (conn == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       j = waitpid(pid, NULL, WNOHANG);</td><td> </td><td class="right">                       j = waitpid(pid, NULL, WNOHANG);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ck_assert_int_eq(j, 0);</td><td> </td><td class="right">                       ck_assert_int_eq(j, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sleep(1);</td><td> </td><td class="right">                       sleep(1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       c++;</td><td> </td><td class="right">                       c++;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       } while (conn == NULL &amp;&amp; c &lt; 5);</td><td> </td><td class="right">       } while (conn == NULL &amp;&amp; c &lt; 5);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       fail_if(conn == NULL);</td><td> </td><td class="right">       fail_if(conn == NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       size = QB_MIN(sizeof(struct qb_ipc_request_header), 64);</td><td> </td><td class="right">       size = QB_MIN(sizeof(struct qb_ipc_request_header), 64);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 288</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 308</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (turn_on_fc) {</td><td> </td><td class="right">       if (turn_on_fc) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               ck_assert_int_eq(fc_enabled, QB_TRUE);</td><td> </td><td class="right">               ck_assert_int_eq(fc_enabled, QB_TRUE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_ipcc_disconnect(conn);</td><td> </td><td class="right">       qb_ipcc_disconnect(conn);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       stop_process(pid);</td><td> </td><td class="right">       stop_process(pid);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_txrx_shm_tmo)</td><td> </td><td class="right">START_TEST(test_ipc_txrx_shm_tmo)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       turn_on_fc = QB_FALSE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SHM;</td><td> </td><td class="right">       ipc_type = QB_IPC_SHM;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       recv_timeout = 1000;</td><td> </td><td class="right">       recv_timeout = 1000;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_txrx();</td><td> </td><td class="right">       test_ipc_txrx();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_txrx_shm_block)</td><td> </td><td class="right">START_TEST(test_ipc_txrx_shm_block)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       turn_on_fc = QB_FALSE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SHM;</td><td> </td><td class="right">       ipc_type = QB_IPC_SHM;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       recv_timeout = -1;</td><td> </td><td class="right">       recv_timeout = -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_txrx();</td><td> </td><td class="right">       test_ipc_txrx();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_txrx_us_block)</td><td> </td><td class="right">START_TEST(test_ipc_txrx_us_block)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       turn_on_fc = QB_FALSE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SOCKET;</td><td> </td><td class="right">       ipc_type = QB_IPC_SOCKET;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       recv_timeout = -1;</td><td> </td><td class="right">       recv_timeout = -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_txrx();</td><td> </td><td class="right">       test_ipc_txrx();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_txrx_us_tmo)</td><td> </td><td class="right">START_TEST(test_ipc_txrx_us_tmo)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       turn_on_fc = QB_FALSE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SOCKET;</td><td> </td><td class="right">       ipc_type = QB_IPC_SOCKET;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       recv_timeout = 1000;</td><td> </td><td class="right">       recv_timeout = 1000;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_txrx();</td><td> </td><td class="right">       test_ipc_txrx();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_fc_shm)</td><td> </td><td class="right">START_TEST(test_ipc_fc_shm)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       turn_on_fc = QB_TRUE;</td><td> </td><td class="right">       turn_on_fc = QB_TRUE;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SHM;</td><td> </td><td class="right">       ipc_type = QB_IPC_SHM;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">recv_timeout = 500;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_txrx();</td><td> </td><td class="right">       test_ipc_txrx();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_fc_us)</td><td> </td><td class="right">START_TEST(test_ipc_fc_us)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       turn_on_fc = QB_TRUE;</td><td> </td><td class="right">       turn_on_fc = QB_TRUE;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SOCKET;</td><td> </td><td class="right">       ipc_type = QB_IPC_SOCKET;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">recv_timeout = 500;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_txrx();</td><td> </td><td class="right">       test_ipc_txrx();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_txrx_pmq)</td><td> </td><td class="right">START_TEST(test_ipc_txrx_pmq)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       turn_on_fc = QB_FALSE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_POSIX_MQ;</td><td> </td><td class="right">       ipc_type = QB_IPC_POSIX_MQ;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_txrx();</td><td> </td><td class="right">       test_ipc_txrx();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_txrx_smq)</td><td> </td><td class="right">START_TEST(test_ipc_txrx_smq)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       turn_on_fc = QB_FALSE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SYSV_MQ;</td><td> </td><td class="right">       ipc_type = QB_IPC_SYSV_MQ;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_txrx();</td><td> </td><td class="right">       test_ipc_txrx();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">struct my_res {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       struct qb_ipc_response_header hdr;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       char message[1024 * 1024];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">};</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">static struct my_res response;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void test_ipc_dispatch(void)</td><td> </td><td class="right">static void test_ipc_dispatch(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t res;</td><td> </td><td class="right">       int32_t res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t j;</td><td> </td><td class="right">       int32_t j;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t c = 0;</td><td> </td><td class="right">       int32_t c = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       pid_t pid;</td><td> </td><td class="right">       pid_t pid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       struct qb_ipc_request_header req_header;</td><td> </td><td class="right">       struct qb_ipc_request_header req_header;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       struct qb_ipc_response_header *res_header = (struct qb_ipc_response_
header*)buffer;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       pid = run_function_in_new_process(run_ipc_server);</td><td> </td><td class="right">       pid = run_function_in_new_process(run_ipc_server);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       fail_if(pid == -1);</td><td> </td><td class="right">       fail_if(pid == -1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sleep(1);</td><td> </td><td class="right">       sleep(1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       do {</td><td> </td><td class="right">       do {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               conn = qb_ipcc_connect(<span class="delete">IPC_NAME</span>, MAX_MSG_SIZE);</td><td> </td><td class="rblock">               conn = qb_ipcc_connect(<span class="insert">ipc_name</span>, MAX_MSG_SIZE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (conn == NULL) {</td><td> </td><td class="right">               if (conn == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       j = waitpid(pid, NULL, WNOHANG);</td><td> </td><td class="right">                       j = waitpid(pid, NULL, WNOHANG);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ck_assert_int_eq(j, 0);</td><td> </td><td class="right">                       ck_assert_int_eq(j, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sleep(1);</td><td> </td><td class="right">                       sleep(1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       c++;</td><td> </td><td class="right">                       c++;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       } while (conn == NULL &amp;&amp; c &lt; 5);</td><td> </td><td class="right">       } while (conn == NULL &amp;&amp; c &lt; 5);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       fail_if(conn == NULL);</td><td> </td><td class="right">       fail_if(conn == NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       req_header.id = IPC_MSG_REQ_DISPATCH;</td><td> </td><td class="right">       req_header.id = IPC_MSG_REQ_DISPATCH;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       req_header.size = sizeof(struct qb_ipc_request_header);</td><td> </td><td class="right">       req_header.size = sizeof(struct qb_ipc_request_header);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> repeat_send:</td><td> </td><td class="right"> repeat_send:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       res = qb_ipcc_send(conn, &amp;req_header, req_header.size);</td><td> </td><td class="right">       res = qb_ipcc_send(conn, &amp;req_header, req_header.size);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (res &lt; 0) {</td><td> </td><td class="right">       if (res &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (res == -EAGAIN) {</td><td> </td><td class="right">               if (res == -EAGAIN) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       goto repeat_send;</td><td> </td><td class="right">                       goto repeat_send;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               } else if (res == -EINVAL || res == -EINTR) {</td><td> </td><td class="right">               } else if (res == -EINVAL || res == -EINTR) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">perror(</span>"qb_ipcc_send");</td><td> </td><td class="rblock">                       <span class="insert">qb_perror(LOG_INFO, </span>"qb_ipcc_send");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       return;</td><td> </td><td class="right">                       return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               } else {</td><td> </td><td class="right">               } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       errno = -res;</td><td> </td><td class="right">                       errno = -res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">perror(</span>"qb_ipcc_send");</td><td> </td><td class="rblock">                       <span class="insert">qb_perror(LOG_INFO, </span>"qb_ipcc_send");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       goto repeat_send;</td><td> </td><td class="right">                       goto repeat_send;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> repeat_event_recv:</td><td> </td><td class="right"> repeat_event_recv:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       res = qb_ipcc_event_recv(conn, <span class="delete">res_header, IPC_BUF_SIZE</span>, 0);</td><td> </td><td class="rblock">       res = qb_ipcc_event_recv(conn, <span class="insert">&amp;response, sizeof(struct my_res)</span>, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (res &lt; 0) {</td><td> </td><td class="right">       if (res &lt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (res == -EAGAIN || res == -ETIMEDOUT) {</td><td> </td><td class="right">               if (res == -EAGAIN || res == -ETIMEDOUT) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       goto repeat_event_recv;</td><td> </td><td class="right">                       goto repeat_event_recv;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               } else {</td><td> </td><td class="right">               } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       errno = -res;</td><td> </td><td class="right">                       errno = -res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">perror(</span>"qb_ipcc_event_recv");</td><td> </td><td class="rblock">                       <span class="insert">qb_perror(LOG_INFO, </span>"qb_ipcc_event_recv");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       goto repeat_send;</td><td> </td><td class="right">                       goto repeat_send;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ck_assert_int_eq(res, sizeof(struct qb_ipc_response_header));</td><td> </td><td class="right">       ck_assert_int_eq(res, sizeof(struct qb_ipc_response_header));</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       ck_assert_int_eq(res<span class="delete">_header-&gt;</span>id, IPC_MSG_RES_DISPATCH);</td><td> </td><td class="rblock">       ck_assert_int_eq(res<span class="insert">ponse.hdr.</span>id, IPC_MSG_RES_DISPATCH);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_ipcc_disconnect(conn);</td><td> </td><td class="right">       qb_ipcc_disconnect(conn);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       stop_process(pid);</td><td> </td><td class="right">       stop_process(pid);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_disp_shm)</td><td> </td><td class="right">START_TEST(test_ipc_disp_shm)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SHM;</td><td> </td><td class="right">       ipc_type = QB_IPC_SHM;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_dispatch();</td><td> </td><td class="right">       test_ipc_dispatch();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_disp_us)</td><td> </td><td class="right">START_TEST(test_ipc_disp_us)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SOCKET;</td><td> </td><td class="right">       ipc_type = QB_IPC_SOCKET;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_dispatch();</td><td> </td><td class="right">       test_ipc_dispatch();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#ifdef IPC_HANDLES_FAILED_SERVER</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void test_ipc_server_fail(void)</td><td> </td><td class="right">static void test_ipc_server_fail(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       struct qb_ipc_request_header req_header;</td><td> </td><td class="right">       struct qb_ipc_request_header req_header;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       struct qb_ipc_response_header res_header;</td><td> </td><td class="right">       struct qb_ipc_response_header res_header;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t res;</td><td> </td><td class="right">       int32_t res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t try_times = 0;</td><td> </td><td class="right">       int32_t try_times = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t j;</td><td> </td><td class="right">       int32_t j;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t c = 0;</td><td> </td><td class="right">       int32_t c = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       pid_t pid;</td><td> </td><td class="right">       pid_t pid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       pid = run_function_in_new_process(run_ipc_server);</td><td> </td><td class="right">       pid = run_function_in_new_process(run_ipc_server);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       fail_if(pid == -1);</td><td> </td><td class="right">       fail_if(pid == -1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sleep(1);</td><td> </td><td class="right">       sleep(1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       do {</td><td> </td><td class="right">       do {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               conn = qb_ipcc_connect(<span class="delete">IPC_NAME</span>, MAX_MSG_SIZE);</td><td> </td><td class="rblock">               conn = qb_ipcc_connect(<span class="insert">ipc_name</span>, MAX_MSG_SIZE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (conn == NULL) {</td><td> </td><td class="right">               if (conn == NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       j = waitpid(pid, NULL, WNOHANG);</td><td> </td><td class="right">                       j = waitpid(pid, NULL, WNOHANG);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ck_assert_int_eq(j, 0);</td><td> </td><td class="right">                       ck_assert_int_eq(j, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sleep(1);</td><td> </td><td class="right">                       sleep(1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       c++;</td><td> </td><td class="right">                       c++;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       } while (conn == NULL &amp;&amp; c &lt; 5);</td><td> </td><td class="right">       } while (conn == NULL &amp;&amp; c &lt; 5);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       fail_if(conn == NULL);</td><td> </td><td class="right">       fail_if(conn == NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       /*</td><td> </td><td class="right">       /*</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 483</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 528</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        */</td><td> </td><td class="right">        */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ck_assert_int_eq(res, -ENOTCONN);</td><td> </td><td class="right">       ck_assert_int_eq(res, -ENOTCONN);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qb_ipcc_disconnect(conn);</td><td> </td><td class="right">       qb_ipcc_disconnect(conn);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       stop_process(pid);</td><td> </td><td class="right">       stop_process(pid);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_server_fail_soc)</td><td> </td><td class="right">START_TEST(test_ipc_server_fail_soc)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SOCKET;</td><td> </td><td class="right">       ipc_type = QB_IPC_SOCKET;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_server_fail();</td><td> </td><td class="right">       test_ipc_server_fail();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">START_TEST(test_ipc_server_fail_shm)</td><td> </td><td class="right">START_TEST(test_ipc_server_fail_shm)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ipc_type = QB_IPC_SHM;</td><td> </td><td class="right">       ipc_type = QB_IPC_SHM;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       ipc_name = __func__;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       test_ipc_server_fail();</td><td> </td><td class="right">       test_ipc_server_fail();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">END_TEST</td><td> </td><td class="right">END_TEST</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#endif /* IPC_HANDLES_FAILED_SERVER */</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static Suite *ipc_suite(void)</td><td> </td><td class="right">static Suite *ipc_suite(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       TCase *tc;</td><td> </td><td class="right">       TCase *tc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       uid_t uid;</td><td> </td><td class="right">       uid_t uid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Suite *s = suite_create("ipc");</td><td> </td><td class="right">       Suite *s = suite_create("ipc");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#ifdef IPC_HANDLES_FAILED_SERVER</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tc = tcase_create("ipc_server_fail_shm");</td><td> </td><td class="right">       tc = tcase_create("ipc_server_fail_shm");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tcase_add_test(tc, test_ipc_server_fail_shm);</td><td> </td><td class="right">       tcase_add_test(tc, test_ipc_server_fail_shm);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tcase_set_timeout(tc, 6);</td><td> </td><td class="right">       tcase_set_timeout(tc, 6);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       suite_add_tcase(s, tc);</td><td> </td><td class="right">       suite_add_tcase(s, tc);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tc = tcase_create("ipc_server_fail_soc");</td><td> </td><td class="right">       tc = tcase_create("ipc_server_fail_soc");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tcase_add_test(tc, test_ipc_server_fail_soc);</td><td> </td><td class="right">       tcase_add_test(tc, test_ipc_server_fail_soc);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tcase_set_timeout(tc, 6);</td><td> </td><td class="right">       tcase_set_timeout(tc, 6);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       suite_add_tcase(s, tc);</td><td> </td><td class="right">       suite_add_tcase(s, tc);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#endif /* IPC_HANDLES_FAILED_SERVER */</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tc = tcase_create("ipc_txrx_shm_block");</td><td> </td><td class="right">       tc = tcase_create("ipc_txrx_shm_block");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tcase_add_test(tc, test_ipc_txrx_shm_block);</td><td> </td><td class="right">       tcase_add_test(tc, test_ipc_txrx_shm_block);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tcase_set_timeout(tc, 6);</td><td> </td><td class="right">       tcase_set_timeout(tc, 6);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       suite_add_tcase(s, tc);</td><td> </td><td class="right">       suite_add_tcase(s, tc);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tc = tcase_create("ipc_txrx_shm_tmo");</td><td> </td><td class="right">       tc = tcase_create("ipc_txrx_shm_tmo");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tcase_add_test(tc, test_ipc_txrx_shm_tmo);</td><td> </td><td class="right">       tcase_add_test(tc, test_ipc_txrx_shm_tmo);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tcase_set_timeout(tc, 6);</td><td> </td><td class="right">       tcase_set_timeout(tc, 6);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       suite_add_tcase(s, tc);</td><td> </td><td class="right">       suite_add_tcase(s, tc);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 572</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 622</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return s;</td><td> </td><td class="right">       return s;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">int32_t main(void)</td><td> </td><td class="right">int32_t main(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int32_t number_failed;</td><td> </td><td class="right">       int32_t number_failed;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Suite *s = ipc_suite();</td><td> </td><td class="right">       Suite *s = ipc_suite();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       SRunner *sr = srunner_create(s);</td><td> </td><td class="right">       SRunner *sr = srunner_create(s);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">qb_util_set_log_function(ipc_log_fn);</span></td><td> </td><td class="rblock">       <span class="insert">qb_log_init("check", LOG_USER, LOG_EMERG);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       qb_log_ctl(QB_LOG_SYSLOG, QB_LOG_CONF_ENABLED, QB_FALSE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       qb_log_filter_ctl(QB_LOG_STDERR, QB_LOG_FILTER_ADD,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                         QB_LOG_FILTER_FILE, "*", LOG_INFO);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       qb_log_ctl(QB_LOG_STDERR, QB_LOG_CONF_ENABLED, QB_TRUE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       srunner_run_all(sr, CK_VERBOSE);</td><td> </td><td class="right">       srunner_run_all(sr, CK_VERBOSE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       number_failed = srunner_ntests_failed(sr);</td><td> </td><td class="right">       number_failed = srunner_ntests_failed(sr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       srunner_free(sr);</td><td> </td><td class="right">       srunner_free(sr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return (number_failed == 0) ? EXIT_SUCCESS : EXIT_FAILURE;</td><td> </td><td class="right">       return (number_failed == 0) ? EXIT_SUCCESS : EXIT_FAILURE;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 56 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>34 lines changed or deleted</i></th><th><i> </i></th><th><i>87 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
